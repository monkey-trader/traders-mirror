[{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/application/trade/services/TradeService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[240,243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[240,243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349,352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349,352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[643,646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[643,646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\nimport { TradeService } from './TradeService';\nimport { TradeInput } from '@/domain/trade/entities/TradeFactory';\n\nclass MockRepo {\n  trades: TradeInput[] = [];\n  async save(trade: any) {\n    this.trades.push(trade);\n  }\n  async getAll() {\n    return this.trades;\n  }\n  async update(trade: any) {\n    const idx = this.trades.findIndex((t) => t.id === trade.id);\n    if (idx >= 0) this.trades[idx] = trade;\n  }\n}\n\ndescribe('TradeService', () => {\n  let service: TradeService;\n  let repo: MockRepo;\n  beforeEach(() => {\n    repo = new MockRepo();\n    service = new TradeService(repo as any);\n  });\n\n  it('should add and list trades', async () => {\n    const input: TradeInput = {\n      id: '1',\n      symbol: 'AAPL',\n      entryDate: '2023-01-01T00:00:00Z',\n      size: 1,\n      price: 100,\n      side: 'LONG',\n      margin: 50,\n    };\n    await service.addTrade(input);\n    const trades = await service.listTrades();\n    expect(trades.length).toBe(1);\n    expect(trades[0].symbol).toBe('AAPL');\n  });\n\n  it('should update a trade', async () => {\n    const input: TradeInput = {\n      id: '1',\n      symbol: 'AAPL',\n      entryDate: '2023-01-01T00:00:00Z',\n      size: 1,\n      price: 100,\n      side: 'LONG',\n      margin: 50,\n    };\n    await service.addTrade(input);\n    await service.updateTrade({ ...input, price: 200 });\n    const trades = await service.listTrades();\n    expect(trades[0].price).toBe(200);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/application/trade/services/TradeService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/custom.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/entities/Trade.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/entities/Trade.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/entities/TradeFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/errors/DomainError.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/interfaces/TradeRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/EntryDate.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/EntryDate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Leverage.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[466,469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[466,469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { Leverage } from './Leverage';\n\ndescribe('Leverage VO', () => {\n  it('accepts undefined and numeric values', () => {\n    expect(new Leverage().value).toBeUndefined();\n    expect(new Leverage(10).value).toBe(10);\n  });\n\n  it('throws on invalid numbers (<=0 or NaN)', () => {\n    expect(() => new Leverage(0)).toThrow();\n    expect(() => new Leverage(-5)).toThrow();\n    expect(() => new Leverage(Number('abc' as any))).toThrow();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Leverage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Margin.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[744,747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[744,747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { Margin, MarginMustBePositiveError } from './Margin';\n\ndescribe('Margin Value Object', () => {\n  it('should create a Margin for positive values', () => {\n    expect(new Margin(1).value).toBe(1);\n    expect(new Margin(100).value).toBe(100);\n  });\n\n  it('should throw for zero or negative values', () => {\n    expect(() => new Margin(0)).toThrow(MarginMustBePositiveError);\n    expect(() => new Margin(-1)).toThrow(MarginMustBePositiveError);\n  });\n\n  it('should throw for NaN or non-number', () => {\n    expect(() => new Margin(NaN)).toThrow(MarginMustBePositiveError);\n    expect(() => new Margin(undefined as any)).toThrow(MarginMustBePositiveError);\n    expect(() => new Margin('foo' as any)).toThrow(MarginMustBePositiveError);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Margin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Market.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[460,463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[460,463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[575,578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[575,578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { Market, MarketInvalidError } from './Market';\n\ndescribe('Market VO', () => {\n  it('normalizes forex and crypto', () => {\n    expect(new Market('forex').value).toBe('Forex');\n    expect(new Market('CRYPTO').value).toBe('Crypto');\n  });\n\n  it('normalizes all', () => {\n    expect(new Market('all').value).toBe('All');\n  });\n\n  it('throws on invalid market', () => {\n    expect(() => new Market('stocks' as any)).toThrow();\n  });\n\n  it('throws MarketInvalidError on empty input', () => {\n    expect(() => new Market('' as any)).toThrow(MarketInvalidError);\n    // @ts-expect-error intentional invalid\n    expect(() => new Market(undefined)).toThrow(MarketInvalidError);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Market.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Price.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Price.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Side.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Side.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Size.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { Size, SizeMustBePositiveError } from './Size';\n\ndescribe('Size VO', () => {\n  it('accepts positive sizes', () => {\n    const s = new Size(1);\n    expect(s).toBeInstanceOf(Size);\n    expect(s.value).toBe(1);\n  });\n\n  it('throws SizeMustBePositiveError for zero', () => {\n    expect(() => new Size(0)).toThrow(SizeMustBePositiveError);\n  });\n\n  it('throws SizeMustBePositiveError for non-number inputs', () => {\n    expect(() => new Size(undefined as any)).toThrow(SizeMustBePositiveError);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/Size.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/TradeSymbol.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/domain/trade/valueObjects/TradeSymbol.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/infrastructure/trade/repositories/InMemoryTradeRepository.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'voLike' is assigned a value but never used.","line":65,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2632,2635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2632,2635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\nimport InMemoryTradeRepository from './InMemoryTradeRepository';\nimport { TradeFactory } from '@/domain/trade/entities/TradeFactory';\n\ndescribe('InMemoryTradeRepository', () => {\n  let repo: InMemoryTradeRepository;\n\n  beforeEach(() => {\n    repo = new InMemoryTradeRepository();\n  });\n\n  it('initializes with default mock trades', async () => {\n    const trades = await repo.getAll();\n    expect(Array.isArray(trades)).toBe(true);\n    expect(trades.length).toBeGreaterThan(0);\n  });\n\n  it('saves a domain Trade (via TradeFactory.toDTO) and then returns it in getAll', async () => {\n    const trade = TradeFactory.create({\n      id: 't-save',\n      symbol: 'TEST1',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 10,\n      side: 'LONG',\n    });\n    const before = await repo.getAll();\n    await repo.save(trade);\n    const after = await repo.getAll();\n    expect(after.length).toBe(before.length + 1);\n    const found = after.find((t) => t.symbol.value === 'TEST1');\n    expect(found).toBeDefined();\n    expect(found?.price.value).toBe(10);\n  });\n\n  it('updates an existing trade', async () => {\n    const trades = await repo.getAll();\n    const t = trades[0];\n    const originalPrice = t.price.value;\n    const modified = TradeFactory.create({\n      id: t.id,\n      symbol: t.symbol.value,\n      entryDate: t.entryDate.value,\n      size: t.size.value,\n      price: originalPrice + 1,\n      side: t.side.value,\n    });\n    await repo.update(modified);\n    const reloaded = await repo.getAll();\n    const updated = reloaded.find((r) => r.id === t.id);\n    expect(updated).toBeDefined();\n    expect(updated?.price.value).toBe(originalPrice + 1);\n  });\n\n  it('deletes an existing trade', async () => {\n    const trades = await repo.getAll();\n    const t = trades[0];\n    await repo.delete(t.id);\n    const after = await repo.getAll();\n    expect(after.find((r) => r.id === t.id)).toBeUndefined();\n  });\n\n  it('toRepoTrade accepts VO-like objects and primitive shapes', async () => {\n    // VO-like shape\n    const voLike = {\n      id: 'vo1',\n      market: 'Crypto',\n      symbol: { value: 'VOUSD' },\n      entryDate: { value: new Date().toISOString() },\n      size: { value: 2 },\n      price: { value: 5 },\n      side: { value: 'LONG' },\n    };\n    const fakeTrade = TradeFactory.create({\n      id: 'vo1',\n      symbol: 'VOUSD',\n      entryDate: new Date().toISOString(),\n      size: 2,\n      price: 5,\n      side: 'LONG',\n    });\n    // mimic VO by converting to DTO and then manually replacing fields\n    const dto = TradeFactory.toDTO(fakeTrade) as any;\n    dto.symbol = { value: 'VOUSD' };\n    dto.size = { value: 2 };\n    dto.price = { value: 5 };\n    dto.side = { value: 'LONG' };\n\n    // Save using save() path\n    await repo.save(fakeTrade);\n    const all = await repo.getAll();\n    expect(all.find((t) => t.id === 'vo1' || t.symbol.value === 'VOUSD')).toBeDefined();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/infrastructure/trade/repositories/InMemoryTradeRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6760,6763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6760,6763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":430,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":430,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10693,10777],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TradeFactory } from '@/domain/trade/entities/TradeFactory';\nimport { Trade } from '@/domain/trade/entities/Trade';\n\n// Simple in-memory repository used for demo/testing. Not persistent.\nexport type RepoTrade = {\n  id: string;\n  market: 'Crypto' | 'Forex' | 'All';\n  symbol: string;\n  entryDate: string;\n  size: number;\n  price: number;\n  side: 'LONG' | 'SHORT';\n  status: 'OPEN' | 'CLOSED' | 'FILLED';\n  pnl: number;\n  notes?: string;\n  entry?: string;\n  sl?: number;\n  tp1?: number;\n  tp2?: number;\n  tp3?: number;\n  tp4?: number;\n  margin?: number;\n  leverage?: number;\n};\n\nconst DEFAULT_MOCK_TRADES: RepoTrade[] = [\n  {\n    id: 't1',\n    market: 'Crypto',\n    symbol: 'ETHUSD',\n    entryDate: '2025-12-21T10:12:00Z',\n    size: 0.51,\n    price: 1800.5,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: 0,\n    notes: 'Scalp-Short nach Fehlausbruch.',\n    entry: '1802.0',\n    sl: 1815.0,\n    tp1: 1790.0,\n    tp2: 1775.0,\n    tp3: 1750.0,\n    margin: 120,\n    leverage: 10,\n  },\n  {\n    id: 't2',\n    market: 'Crypto',\n    symbol: 'ETHUSD',\n    entryDate: '2025-12-21T09:50:00Z',\n    size: 0.37,\n    price: 1795.3,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 0,\n    notes: 'Rebound nach Support.',\n    entry: '1794.0',\n    sl: 1790.0,\n    tp1: 1805.0,\n    tp2: 1820.0,\n    tp3: 1850.0,\n    margin: 90,\n    leverage: 8,\n  },\n  {\n    id: 't3',\n    market: 'Forex',\n    symbol: 'EURUSD',\n    entryDate: '2025-12-20T08:30:00Z',\n    size: 10000,\n    price: 1.1203,\n    side: 'LONG',\n    status: 'CLOSED',\n    pnl: -12.5,\n    notes: 'Reverted on news',\n    entry: '1.1190',\n    sl: 1.117,\n    tp1: 1.125,\n    tp2: 1.128,\n    tp3: 1.13,\n    margin: 100,\n    leverage: 10,\n  },\n  {\n    id: 't4',\n    market: 'Crypto',\n    symbol: 'BTCUSD',\n    entryDate: '2025-12-22T11:00:00Z',\n    size: 0.12,\n    price: 42000.0,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 150.5,\n    notes: 'Breakout trade, trailing SL.',\n    entry: '41950',\n    sl: 41700,\n    tp1: 42500,\n    tp2: 43000,\n    tp3: 44000,\n    margin: 500,\n    leverage: 5,\n  },\n  {\n    id: 't5',\n    market: 'Crypto',\n    symbol: 'SOLUSD',\n    entryDate: '2025-12-22T10:30:00Z',\n    size: 10,\n    price: 95.2,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: -20.1,\n    notes: 'Short nach Fehlausbruch.',\n    entry: '96.0',\n    sl: 98.0,\n    tp1: 92.0,\n    tp2: 89.0,\n    tp3: 85.0,\n    margin: 200,\n    leverage: 3,\n  },\n  {\n    id: 't6',\n    market: 'Forex',\n    symbol: 'USDJPY',\n    entryDate: '2025-12-22T09:45:00Z',\n    size: 5000,\n    price: 134.55,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 10.0,\n    notes: 'Range-Breakout, TP1 erreicht.',\n    entry: '134.20',\n    sl: 133.8,\n    tp1: 134.8,\n    tp2: 135.2,\n    tp3: 136.0,\n    margin: 150,\n    leverage: 20,\n  },\n  {\n    id: 't7',\n    market: 'Crypto',\n    symbol: 'ADAUSD',\n    entryDate: '2025-12-22T08:10:00Z',\n    size: 200,\n    price: 1.25,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 5.5,\n    notes: 'Scalp, schnelle Bewegung erwartet.',\n    entry: '1.24',\n    sl: 1.22,\n    tp1: 1.28,\n    tp2: 1.32,\n    tp3: 1.36,\n    margin: 50,\n    leverage: 10,\n  },\n  {\n    id: 't8',\n    market: 'Forex',\n    symbol: 'GBPUSD',\n    entryDate: '2025-12-22T07:30:00Z',\n    size: 8000,\n    price: 1.32,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: -8.2,\n    notes: 'News-Event, SL eng.',\n    entry: '1.3210',\n    sl: 1.323,\n    tp1: 1.318,\n    tp2: 1.315,\n    tp3: 1.31,\n    margin: 120,\n    leverage: 15,\n  },\n  {\n    id: 't9',\n    market: 'Crypto',\n    symbol: 'XRPUSD',\n    entryDate: '2025-12-22T06:50:00Z',\n    size: 500,\n    price: 0.95,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 2.1,\n    notes: 'TP1 fast erreicht.',\n    entry: '0.94',\n    sl: 0.92,\n    tp1: 0.97,\n    tp2: 1.0,\n    tp3: 1.05,\n    margin: 30,\n    leverage: 8,\n  },\n  {\n    id: 't10',\n    market: 'Crypto',\n    symbol: 'DOGEUSD',\n    entryDate: '2025-12-22T06:20:00Z',\n    size: 1000,\n    price: 0.12,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: -1.5,\n    notes: 'Memecoin-Short, hohes Risiko.',\n    entry: '0.13',\n    sl: 0.14,\n    tp1: 0.11,\n    tp2: 0.1,\n    tp3: 0.09,\n    margin: 25,\n    leverage: 2,\n  },\n  {\n    id: 't11',\n    market: 'Forex',\n    symbol: 'AUDUSD',\n    entryDate: '2025-12-22T05:40:00Z',\n    size: 6000,\n    price: 0.755,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 3.3,\n    notes: 'TP2 Ziel, SL nachgezogen.',\n    entry: '0.7540',\n    sl: 0.752,\n    tp1: 0.757,\n    tp2: 0.76,\n    tp3: 0.765,\n    margin: 80,\n    leverage: 12,\n  },\n  {\n    id: 't12',\n    market: 'Crypto',\n    symbol: 'MATICUSD',\n    entryDate: '2025-12-22T05:10:00Z',\n    size: 300,\n    price: 2.1,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 7.7,\n    notes: 'Layer2 Hype, TP1 erreicht.',\n    entry: '2.05',\n    sl: 2.0,\n    tp1: 2.15,\n    tp2: 2.25,\n    tp3: 2.4,\n    margin: 60,\n    leverage: 7,\n  },\n  {\n    id: 't13',\n    market: 'Forex',\n    symbol: 'USDCAD',\n    entryDate: '2025-12-22T04:30:00Z',\n    size: 4000,\n    price: 1.27,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: -4.0,\n    notes: 'Korrektur-Short, TP1 offen.',\n    entry: '1.2710',\n    sl: 1.273,\n    tp1: 1.268,\n    tp2: 1.265,\n    tp3: 1.26,\n    margin: 70,\n    leverage: 9,\n  },\n  {\n    id: 't14',\n    market: 'Crypto',\n    symbol: 'BTCUSD',\n    entryDate: '2025-12-27T21:51:00Z',\n    size: 1,\n    price: 80000,\n    side: 'LONG',\n    status: 'OPEN',\n    pnl: 0,\n    notes: 'Test Entry',\n    entry: '79900',\n    sl: 78000,\n    tp1: 81000,\n    tp2: 82000,\n    tp3: 83000,\n    tp4: 84000,\n    margin: 1000,\n    leverage: 20,\n  },\n];\n\nexport class InMemoryTradeRepository {\n  // implement interface (kept class name for backwards compatibility)\n  // satisfy TradeRepository signatures below\n  private trades: RepoTrade[];\n\n  constructor(initial: RepoTrade[] = DEFAULT_MOCK_TRADES) {\n    this.trades = initial.map((t) => ({ ...t }));\n  }\n\n  // Narrower typings: accept unknown and detect VO-like shapes safely\n  private isObject(value: unknown): value is Record<string, unknown> {\n    return typeof value === 'object' && value !== null;\n  }\n\n  private looksLikeVOTrade(obj: unknown): obj is Record<string, unknown> {\n    if (!this.isObject(obj)) return false;\n    const maybe = obj as Record<string, unknown>;\n    return (\n      'symbol' in maybe &&\n      this.isObject(maybe.symbol) &&\n      'value' in (maybe.symbol as Record<string, unknown>)\n    );\n  }\n\n  private toRepoTrade(obj: unknown): RepoTrade {\n    // If object looks like a domain Trade (VOs), convert to primitive shape\n    if (this.looksLikeVOTrade(obj)) {\n      const o = obj as Record<string, unknown>;\n      const symbolVO = o.symbol as Record<string, unknown>;\n      const entryDateVO = o.entryDate as Record<string, unknown> | string | undefined;\n\n      return {\n        id: String(o.id),\n        market: (o.market as any) ?? 'All',\n        symbol: String(symbolVO.value),\n        entryDate:\n          entryDateVO && typeof entryDateVO === 'object' && 'value' in entryDateVO\n            ? String((entryDateVO as Record<string, unknown>).value)\n            : String(entryDateVO ?? new Date().toISOString()),\n        size:\n          this.isObject(o.size) && 'value' in (o.size as Record<string, unknown>)\n            ? Number((o.size as Record<string, unknown>).value)\n            : Number(o.size as number),\n        price:\n          this.isObject(o.price) && 'value' in (o.price as Record<string, unknown>)\n            ? Number((o.price as Record<string, unknown>).value)\n            : Number(o.price as number),\n        side:\n          this.isObject(o.side) && 'value' in (o.side as Record<string, unknown>)\n            ? (String((o.side as Record<string, unknown>).value) as 'LONG' | 'SHORT')\n            : (o.side as 'LONG' | 'SHORT'),\n        status: (o.status as RepoTrade['status']) ?? 'OPEN',\n        pnl: Number(o.pnl ?? 0),\n        notes: o.notes as string | undefined,\n        entry: o.entry as string | undefined,\n        sl: typeof o.sl === 'number' ? (o.sl as number) : undefined,\n        tp1: typeof o.tp1 === 'number' ? (o.tp1 as number) : undefined,\n        tp2: typeof o.tp2 === 'number' ? (o.tp2 as number) : undefined,\n        tp3: typeof o.tp3 === 'number' ? (o.tp3 as number) : undefined,\n        tp4: typeof o.tp4 === 'number' ? (o.tp4 as number) : undefined,\n        margin: typeof o.margin === 'number' ? (o.margin as number) : undefined,\n        leverage: typeof o.leverage === 'number' ? (o.leverage as number) : undefined,\n      };\n    }\n\n    // Assume it's already a RepoTrade-like object\n    if (this.isObject(obj)) {\n      const o = obj as Record<string, unknown>;\n      return {\n        id: String(o.id),\n        market: (o.market as RepoTrade['market']) ?? 'All',\n        symbol: String(o.symbol),\n        entryDate: String(o.entryDate),\n        size: Number(o.size as number),\n        price: Number(o.price as number),\n        side: (o.side as RepoTrade['side']) ?? 'LONG',\n        status: (o.status as RepoTrade['status']) ?? 'OPEN',\n        pnl: Number(o.pnl ?? 0),\n        notes: o.notes as string | undefined,\n        entry: o.entry as string | undefined,\n        sl: typeof o.sl === 'number' ? (o.sl as number) : undefined,\n        tp1: typeof o.tp1 === 'number' ? (o.tp1 as number) : undefined,\n        tp2: typeof o.tp2 === 'number' ? (o.tp2 as number) : undefined,\n        tp3: typeof o.tp3 === 'number' ? (o.tp3 as number) : undefined,\n        tp4: typeof o.tp4 === 'number' ? (o.tp4 as number) : undefined,\n        margin: typeof o.margin === 'number' ? (o.margin as number) : undefined,\n        leverage: typeof o.leverage === 'number' ? (o.leverage as number) : undefined,\n      };\n    }\n\n    // Fallback - create a minimal RepoTrade\n    const now = new Date().toISOString();\n    return {\n      id: 'unknown',\n      market: 'All',\n      symbol: 'UNKNOWN',\n      entryDate: now,\n      size: 0,\n      price: 0,\n      side: 'LONG',\n      status: 'OPEN',\n      pnl: 0,\n    };\n  }\n\n  // Accept domain Trade entity; convert to RepoTrade and store\n  async save(trade: Trade): Promise<void> {\n    const dto = TradeFactory.toDTO(trade);\n    const repoTrade = this.toRepoTrade(dto);\n    this.trades.push({ ...repoTrade });\n  }\n\n  // Return domain Trades reconstructed from stored primitives\n  async getAll(): Promise<Trade[]> {\n    return this.trades.map((rt) => {\n      const input = {\n        id: rt.id,\n        symbol: rt.symbol,\n        entryDate: rt.entryDate,\n        size: rt.size,\n        price: rt.price,\n        side: rt.side,\n        notes: rt.notes,\n        market: rt.market,\n        sl: rt.sl,\n        tp1: rt.tp1,\n        tp2: rt.tp2,\n        tp3: rt.tp3,\n        tp4: rt.tp4,\n        leverage: rt.leverage,\n      };\n      try {\n        return TradeFactory.create(input);\n      } catch (err) {\n        console.error('[InMemoryRepo] failed to convert stored trade to domain Trade', err);\n        return TradeFactory.create({\n          id: rt.id,\n          symbol: rt.symbol,\n          entryDate: rt.entryDate,\n          size: rt.size,\n          price: rt.price,\n          side: rt.side,\n        });\n      }\n    });\n  }\n\n  async update(trade: Trade): Promise<void> {\n    const dto = TradeFactory.toDTO(trade);\n    const repoTrade = this.toRepoTrade(dto);\n    const idx = this.trades.findIndex((t) => t.id === repoTrade.id);\n    if (idx >= 0) this.trades[idx] = { ...this.trades[idx], ...repoTrade };\n  }\n\n  // Delete a trade by id\n  async delete(id: string): Promise<void> {\n    const idx = this.trades.findIndex((t) => t.id === id);\n    if (idx >= 0) this.trades.splice(idx, 1);\n  }\n}\n\nexport default InMemoryTradeRepository;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/infrastructure/trade/repositories/LocalStorageTradeRepository.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4960,4963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4960,4963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Include a description after the \"@ts-expect-error\" directive to explain why the @ts-expect-error is necessary. The description must be 3 characters or longer.","line":188,"column":5,"nodeType":"Line","messageId":"tsDirectiveCommentRequiresDescription","endLine":188,"endColumn":24},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Include a description after the \"@ts-expect-error\" directive to explain why the @ts-expect-error is necessary. The description must be 3 characters or longer.","line":203,"column":5,"nodeType":"Line","messageId":"tsDirectiveCommentRequiresDescription","endLine":203,"endColumn":24}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\nimport LocalStorageTradeRepository from '@/infrastructure/trade/repositories/LocalStorageTradeRepository';\nimport { TradeFactory } from '@/domain/trade/entities/TradeFactory';\n\nbeforeEach(() => {\n  if (\n    typeof window !== 'undefined' &&\n    window.localStorage &&\n    typeof window.localStorage.clear === 'function'\n  ) {\n    window.localStorage.clear();\n  }\n});\n\ndescribe('LocalStorageTradeRepository', () => {\n  it('saves and retrieves a trade', async () => {\n    const repo = new LocalStorageTradeRepository('test_key', { seedDefaults: false });\n    const trade = TradeFactory.create({\n      id: 't1',\n      symbol: 'BTCUSD',\n      size: 1,\n      price: 1000,\n      side: 'LONG',\n    });\n    await repo.save(trade);\n    const all = await repo.getAll();\n    expect(all.length).toBe(1);\n    expect(all[0].id).toBe('t1');\n    expect(all[0].symbol.value).toBe('BTCUSD');\n    expect(all[0].size.value).toBe(1);\n    expect(all[0].price.value).toBe(1000);\n  });\n\n  it('updates an existing trade', async () => {\n    const repo = new LocalStorageTradeRepository('test_key2', { seedDefaults: false });\n    const trade = TradeFactory.create({\n      id: 't2',\n      symbol: 'ETHUSD',\n      size: 0.5,\n      price: 200,\n      side: 'SHORT',\n    });\n    await repo.save(trade);\n\n    const updated = TradeFactory.create({\n      id: 't2',\n      symbol: 'ETHUSD',\n      size: 1.5,\n      price: 210,\n      side: 'SHORT',\n      notes: 'updated',\n    });\n    await repo.update(updated);\n\n    const all = await repo.getAll();\n    expect(all.length).toBe(1);\n    expect(all[0].id).toBe('t2');\n    expect(all[0].size.value).toBe(1.5);\n    expect(all[0].price.value).toBe(210);\n    expect(all[0].notes).toBe('updated');\n  });\n\n  it('delete removes a trade', async () => {\n    const repo = new LocalStorageTradeRepository('test_key3', { seedDefaults: false });\n    const trade = TradeFactory.create({\n      id: 't3',\n      symbol: 'XRPUSD',\n      size: 10,\n      price: 0.5,\n      side: 'LONG',\n    });\n    await repo.save(trade);\n    let all = await repo.getAll();\n    expect(all.length).toBe(1);\n\n    await repo.delete('t3');\n    all = await repo.getAll();\n    expect(all.length).toBe(0);\n  });\n\n  it('seed accepts RepoTrade[] and persists them', async () => {\n    const repo = new LocalStorageTradeRepository('test_seed', { seedDefaults: false });\n    const seedTrade = {\n      id: 's1',\n      market: 'All',\n      symbol: 'SEED',\n      entryDate: new Date().toISOString(),\n      size: 2,\n      price: 5,\n      side: 'LONG',\n      status: 'OPEN',\n      pnl: 0,\n    };\n    // @ts-expect-error test: passing raw repo shape\n    repo.seed([seedTrade]);\n    const all = await repo.getAll();\n    expect(all.length).toBe(1);\n    expect(all[0].id).toBe('s1');\n    expect(all[0].symbol.value).toBe('SEED');\n  });\n\n  it('update on non-existing performs save', async () => {\n    const repo = new LocalStorageTradeRepository('test_key4', { seedDefaults: false });\n    const trade = TradeFactory.create({ id: 't4', symbol: 'AAA', size: 1, price: 1, side: 'LONG' });\n    await repo.update(trade); // should save when not present\n    const all = await repo.getAll();\n    expect(all.length).toBe(1);\n    expect(all[0].id).toBe('t4');\n  });\n\n  // --- additional tests added below ---\n\n  it('constructor seeds defaults when storage empty', async () => {\n    const key = 'test_defaults';\n    // ensure no data in localStorage\n    window.localStorage.removeItem(key);\n    const repo = new LocalStorageTradeRepository(key);\n    const all = await repo.getAll();\n    expect(all.length).toBeGreaterThan(0);\n    // default mock has id 't1'\n    expect(all.some((t) => t.id === 't1')).toBe(true);\n  });\n\n  it('constructor does not seed when seedDefaults=false', async () => {\n    const key = 'test_no_defaults';\n    window.localStorage.removeItem(key);\n    const repo = new LocalStorageTradeRepository(key, { seedDefaults: false });\n    const all = await repo.getAll();\n    expect(all.length).toBe(0);\n  });\n\n  it('falls back to defaults when localStorage contains malformed JSON', async () => {\n    const key = 'test_malformed';\n    window.localStorage.setItem(key, 'not-a-json');\n    const repo = new LocalStorageTradeRepository(key);\n    const all = await repo.getAll();\n    // should have seeded defaults in catch\n    expect(all.length).toBeGreaterThan(0);\n  });\n\n  it('save persists trade to localStorage', async () => {\n    const key = 'test_persist';\n    window.localStorage.removeItem(key);\n    const repo = new LocalStorageTradeRepository(key, { seedDefaults: false });\n    const trade = TradeFactory.create({\n      id: 'p1',\n      symbol: 'SAVE',\n      size: 3,\n      price: 10,\n      side: 'LONG',\n    });\n    await repo.save(trade);\n    const raw = window.localStorage.getItem(key);\n    expect(raw).toBeTruthy();\n    const parsed = JSON.parse(raw as string);\n    expect(Array.isArray(parsed)).toBe(true);\n    expect(parsed.find((r: any) => r.id === 'p1')).toBeTruthy();\n  });\n\n  it('seed prepends new trades (order preserved)', async () => {\n    const key = 'test_seed_order';\n    window.localStorage.removeItem(key);\n    const repo = new LocalStorageTradeRepository(key, { seedDefaults: false });\n    const seedA = {\n      id: 'a1',\n      market: 'All',\n      symbol: 'A',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 1,\n      side: 'LONG',\n      status: 'OPEN',\n      pnl: 0,\n    };\n    const seedB = {\n      id: 'b1',\n      market: 'All',\n      symbol: 'B',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 2,\n      side: 'LONG',\n      status: 'OPEN',\n      pnl: 0,\n    };\n    // @ts-expect-error passing raw repo shapes\n    repo.seed([seedA]);\n    // @ts-expect-error\n    repo.seed([seedB]);\n    const raw = window.localStorage.getItem(key) as string;\n    const parsed = JSON.parse(raw);\n    // seedB should be first element because seed prepends\n    expect(parsed[0].id).toBe('b1');\n    expect(parsed[1].id).toBe('a1');\n  });\n\n  it('seed is no-op for invalid input', async () => {\n    const key = 'test_seed_noop';\n    window.localStorage.removeItem(key);\n    const repo = new LocalStorageTradeRepository(key, { seedDefaults: false });\n    // @ts-expect-error pass invalid\n    repo.seed(undefined);\n    // @ts-expect-error\n    repo.seed([]);\n    const raw = window.localStorage.getItem(key);\n    expect(raw).toBeNull();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/infrastructure/trade/repositories/LocalStorageTradeRepository.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[1970,2042],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":73,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":73,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[2172,2233],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":76,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":76,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[2283,2350],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2385,2447],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[2931,2997],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[3113,3202],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":100,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":100,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3229,3304],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4117,4120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4117,4120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":201,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":201,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[7366,7420],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":229,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":229,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8119,8207],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":249,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":249,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[8786,8842],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":252,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":252,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[8882,9004],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[9235,9281],"text":""},"desc":"Remove the console.info()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// LocalStorage-backed repository with logging\n// Mirrors the shape/behaviour of InMemoryTradeRepository but persists to window.localStorage\n\nimport type { TradeRepository } from '@/domain/trade/interfaces/TradeRepository';\nimport { TradeFactory } from '@/domain/trade/entities/TradeFactory';\nimport { Trade } from '@/domain/trade/entities/Trade';\n\nexport type RepoTrade = {\n  id: string;\n  market: 'Crypto' | 'Forex' | 'All';\n  symbol: string;\n  entryDate: string;\n  size: number;\n  price: number;\n  side: 'LONG' | 'SHORT';\n  status: 'OPEN' | 'CLOSED' | 'FILLED';\n  pnl: number;\n  notes?: string;\n  entry?: string;\n  sl?: number;\n  tp1?: number;\n  tp2?: number;\n  tp3?: number;\n  tp4?: number;\n  margin?: number;\n  leverage?: number;\n};\n\nconst STORAGE_KEY = 'mt_trades_v1';\n\nconst DEFAULT_MOCK_TRADES: RepoTrade[] = [\n  // keep a small default set similar to InMemory for first-run UX\n  {\n    id: 't1',\n    market: 'Crypto',\n    symbol: 'ETHUSD',\n    entryDate: '2025-12-21T10:12:00Z',\n    size: 0.51,\n    price: 1800.5,\n    side: 'SHORT',\n    status: 'OPEN',\n    pnl: 0,\n    notes: 'Scalp-Short nach Fehlausbruch.',\n    entry: '1802.0',\n    sl: 1815.0,\n    tp1: 1790.0,\n    tp2: 1775.0,\n    tp3: 1750.0,\n    tp4: 1730.0,\n    margin: 120,\n    leverage: 10,\n  },\n];\n\n// Implement the domain TradeRepository interface: accept/return domain Trade entities\nexport class LocalStorageTradeRepository implements TradeRepository {\n  private trades: RepoTrade[] = [];\n  private key: string;\n\n  // options: { seedDefaults?: boolean } - when false, do not seed DEFAULT_MOCK_TRADES on first run\n  constructor(key = STORAGE_KEY, options?: { seedDefaults?: boolean }) {\n    this.key = key;\n    const seedDefaults = options?.seedDefaults !== undefined ? options?.seedDefaults : true;\n    try {\n      const raw = window.localStorage.getItem(this.key);\n      if (raw) {\n        const parsed = JSON.parse(raw) as RepoTrade[];\n        this.trades = parsed.map((t) => ({ ...t }));\n        console.info('[LocalStorageRepo] loaded', this.trades.length, 'trades');\n      } else if (seedDefaults) {\n        this.trades = DEFAULT_MOCK_TRADES.map((t) => ({ ...t }));\n        this.flush();\n        console.info('[LocalStorageRepo] initialized with defaults');\n      } else {\n        this.trades = [];\n        console.info('[LocalStorageRepo] initialized empty (no defaults)');\n      }\n    } catch (err) {\n      console.error('[LocalStorageRepo] failed to initialize', err);\n      this.trades = seedDefaults ? DEFAULT_MOCK_TRADES.map((t) => ({ ...t })) : [];\n    }\n  }\n\n  // Public helper to seed repository with additional trades and persist immediately.\n  // Accepts an array of RepoTrade and appends them to storage.\n  seed(trades: RepoTrade[]) {\n    if (!Array.isArray(trades) || trades.length === 0) return;\n    // avoid mutating input\n    const toAdd = trades.map((t) => ({ ...t }));\n    this.trades = [...toAdd, ...this.trades];\n    this.flush();\n    console.info('[LocalStorageRepo] seeded', toAdd.length, 'trades');\n  }\n\n  private flush() {\n    try {\n      window.localStorage.setItem(this.key, JSON.stringify(this.trades));\n      console.info('[LocalStorageRepo] flushed', this.trades.length, 'trades to localStorage');\n    } catch (err) {\n      console.error('[LocalStorageRepo] failed to persist to localStorage', err);\n    }\n  }\n\n  private isObject(value: unknown): value is Record<string, unknown> {\n    return typeof value === 'object' && value !== null;\n  }\n\n  private looksLikeVOTrade(obj: unknown): obj is Record<string, unknown> {\n    if (!this.isObject(obj)) return false;\n    const maybe = obj as Record<string, unknown>;\n    return (\n      'symbol' in maybe &&\n      this.isObject(maybe.symbol) &&\n      'value' in (maybe.symbol as Record<string, unknown>)\n    );\n  }\n\n  private toRepoTrade(obj: unknown): RepoTrade {\n    if (this.looksLikeVOTrade(obj)) {\n      const o = obj as Record<string, unknown>;\n      const symbolVO = o.symbol as Record<string, unknown>;\n      const entryDateVO = o.entryDate as Record<string, unknown> | string | undefined;\n\n      return {\n        id: String(o.id),\n        market: (o.market as any) ?? 'All',\n        symbol: String(symbolVO.value),\n        entryDate:\n          entryDateVO && typeof entryDateVO === 'object' && 'value' in entryDateVO\n            ? String((entryDateVO as Record<string, unknown>).value)\n            : String(entryDateVO ?? new Date().toISOString()),\n        size:\n          this.isObject(o.size) && 'value' in (o.size as Record<string, unknown>)\n            ? Number((o.size as Record<string, unknown>).value)\n            : Number(o.size as number),\n        price:\n          this.isObject(o.price) && 'value' in (o.price as Record<string, unknown>)\n            ? Number((o.price as Record<string, unknown>).value)\n            : Number(o.price as number),\n        side:\n          this.isObject(o.side) && 'value' in (o.side as Record<string, unknown>)\n            ? (String((o.side as Record<string, unknown>).value) as 'LONG' | 'SHORT')\n            : (o.side as 'LONG' | 'SHORT'),\n        status: (o.status as RepoTrade['status']) ?? 'OPEN',\n        pnl: Number(o.pnl ?? 0),\n        notes: o.notes as string | undefined,\n        entry: o.entry as string | undefined,\n        sl: typeof o.sl === 'number' ? (o.sl as number) : undefined,\n        tp1: typeof o.tp1 === 'number' ? (o.tp1 as number) : undefined,\n        tp2: typeof o.tp2 === 'number' ? (o.tp2 as number) : undefined,\n        tp3: typeof o.tp3 === 'number' ? (o.tp3 as number) : undefined,\n        tp4: typeof o.tp4 === 'number' ? (o.tp4 as number) : undefined,\n        margin: typeof o.margin === 'number' ? (o.margin as number) : undefined,\n        leverage: typeof o.leverage === 'number' ? (o.leverage as number) : undefined,\n      };\n    }\n\n    if (this.isObject(obj)) {\n      const o = obj as Record<string, unknown>;\n      return {\n        id: String(o.id),\n        market: (o.market as RepoTrade['market']) ?? 'All',\n        symbol: String(o.symbol),\n        entryDate: String(o.entryDate),\n        size: Number(o.size as number),\n        price: Number(o.price as number),\n        side: (o.side as RepoTrade['side']) ?? 'LONG',\n        status: (o.status as RepoTrade['status']) ?? 'OPEN',\n        pnl: Number(o.pnl ?? 0),\n        notes: o.notes as string | undefined,\n        entry: o.entry as string | undefined,\n        sl: typeof o.sl === 'number' ? (o.sl as number) : undefined,\n        tp1: typeof o.tp1 === 'number' ? (o.tp1 as number) : undefined,\n        tp2: typeof o.tp2 === 'number' ? (o.tp2 as number) : undefined,\n        tp3: typeof o.tp3 === 'number' ? (o.tp3 as number) : undefined,\n        tp4: typeof o.tp4 === 'number' ? (o.tp4 as number) : undefined,\n        margin: typeof o.margin === 'number' ? (o.margin as number) : undefined,\n        leverage: typeof o.leverage === 'number' ? (o.leverage as number) : undefined,\n      };\n    }\n\n    const now = new Date().toISOString();\n    return {\n      id: 'unknown',\n      market: 'All',\n      symbol: 'UNKNOWN',\n      entryDate: now,\n      size: 0,\n      price: 0,\n      side: 'LONG',\n      status: 'OPEN',\n      pnl: 0,\n    };\n  }\n\n  // Accept domain Trade entity, persist primitive DTO, and flush\n  async save(trade: Trade): Promise<void> {\n    const dto = TradeFactory.toDTO(trade);\n    const repoTrade = this.toRepoTrade(dto);\n    this.trades.push({ ...repoTrade });\n    console.info('[LocalStorageRepo] save', repoTrade.id);\n    this.flush();\n  }\n\n  // Return domain Trade[] (reconstructed from stored primitives)\n  async getAll(): Promise<Trade[]> {\n    // convert each RepoTrade -> Trade via TradeFactory\n    return this.trades.map((rt) => {\n      const input = {\n        id: rt.id,\n        symbol: rt.symbol,\n        entryDate: rt.entryDate,\n        size: rt.size,\n        price: rt.price,\n        side: rt.side,\n        notes: rt.notes,\n        market: rt.market,\n        sl: rt.sl,\n        tp1: rt.tp1,\n        tp2: rt.tp2,\n        tp3: rt.tp3,\n        tp4: rt.tp4,\n        leverage: rt.leverage,\n        margin: rt.margin,\n      };\n      try {\n        return TradeFactory.create(input);\n      } catch (err) {\n        console.error('[LocalStorageRepo] failed to convert stored trade to domain Trade', err);\n        // create a minimal Trade to keep API stable\n        return TradeFactory.create({\n          id: rt.id,\n          symbol: rt.symbol,\n          entryDate: rt.entryDate,\n          size: rt.size,\n          price: rt.price,\n          side: rt.side,\n        });\n      }\n    });\n  }\n\n  async update(trade: Trade): Promise<void> {\n    const dto = TradeFactory.toDTO(trade);\n    const repoTrade = this.toRepoTrade(dto);\n    const idx = this.trades.findIndex((t) => t.id === repoTrade.id);\n    if (idx >= 0) {\n      this.trades[idx] = { ...this.trades[idx], ...repoTrade };\n      console.info('[LocalStorageRepo] update', repoTrade.id);\n      this.flush();\n    } else {\n      console.warn(\n        '[LocalStorageRepo] update: trade not found, performing save instead',\n        repoTrade.id\n      );\n      await this.save(trade);\n    }\n  }\n\n  // Delete a trade by id\n  async delete(id: string): Promise<void> {\n    const idx = this.trades.findIndex((t) => t.id === id);\n    if (idx >= 0) {\n      this.trades.splice(idx, 1);\n      console.info('[LocalStorageRepo] delete', id);\n      this.flush();\n    }\n  }\n}\n\nexport default LocalStorageTradeRepository;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/infrastructure/trade/repositories/mockData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/Analysis.integration.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[242,245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[242,245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[265,268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[265,268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[410,413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[410,413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { TradeJournal } from '@/presentation/trade/TradeJournal';\n\n// Mock ResizeObserver for jsdom environment used in tests\nclass FakeResizeObserver {\n  callback: any;\n  constructor(cb: any) {\n    this.callback = cb;\n  }\n  observe() {}\n  unobserve() {}\n  disconnect() {}\n}\n\n// attach to global (vitest/node environment)\n(global as any).ResizeObserver = FakeResizeObserver;\n\ndescribe('Analysis -> prefill new trade', () => {\n  it('prefills the New Trade form when creating from analysis', async () => {\n    render(<TradeJournal />);\n\n    // open Analysis tab inside the Trades card\n    const analyseTab = await screen.findByRole('tab', { name: /Analyse/i });\n    fireEvent.click(analyseTab);\n\n    // click the create example button\n    const createBtn = await screen.findByText(/Create example trade from analysis/i);\n    fireEvent.click(createBtn);\n\n    // now the New Trade form on the left should be prefilled with the suggestion (EURUSD)\n    await waitFor(() => {\n      const symbolInput = screen.getByLabelText(/Symbol/i) as HTMLInputElement;\n      expect(symbolInput.value).toMatch(/EURUSD/i);\n\n      const priceInput = screen.getByLabelText(/Price/i) as HTMLInputElement;\n      // price may be formatted as string\n      expect(parseFloat(priceInput.value)).toBeGreaterThan(0);\n\n      const sizeInput = screen.getByLabelText(/Size/i) as HTMLInputElement;\n      expect(Number(sizeInput.value)).toBeGreaterThan(0);\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/Analysis.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/errorMapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[468,471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[468,471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { mapAnalysisError } from './errorMapper';\n\ndescribe('analysis errorMapper', () => {\n  it('maps validation-like error', () => {\n    const err = { field: 'price', message: 'invalid' };\n    const mapped = mapAnalysisError(err);\n    expect((mapped as any).field).toBe('price');\n  });\n\n  it('maps unknown error to generic message', () => {\n    const mapped = mapAnalysisError(new Error('boom'));\n    expect((mapped as any).message).toBeDefined();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/errorMapper.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":4,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":4,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[212,225],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[254,257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[254,257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[283,286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[283,286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function mapAnalysisError(err: unknown) {\n  // Simple mapper: if it's a known validation error object, map to field errors\n  if (err && typeof err === 'object' && 'field' in err && 'message' in err) {\n    // @ts-ignore\n    return { field: (err as any).field, message: (err as any).message };\n  }\n  return { message: 'Unbekannter Fehler bei Analyse-Aktion' };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/validation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[251,254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[251,254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[489,492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[489,492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[739,742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[739,742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { validateSuggestion } from './validation';\n\ndescribe('analysis validation', () => {\n  it('returns error for missing symbol', () => {\n    const res = validateSuggestion({ symbol: '', price: 1 } as any);\n    expect(res.length).toBeGreaterThan(0);\n    expect(res.some((r) => r?.field === 'symbol')).toBeTruthy();\n  });\n\n  it('returns error for invalid price', () => {\n    const res = validateSuggestion({ symbol: 'EURUSD', price: 0 } as any);\n    expect(res.some((r) => r?.field === 'price')).toBeTruthy();\n  });\n\n  it('passes for valid suggestion', () => {\n    const res = validateSuggestion({\n      symbol: 'BTCUSD',\n      price: 42000,\n      size: 0.01,\n      side: 'SHORT',\n    } as any);\n    expect(res.length).toBe(0);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/analysis/validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/settings/Settings.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":36,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from '@testing-library/react';\nimport { Settings } from './Settings';\nimport { TradeJournal } from '@/presentation/trade/TradeJournal';\nimport LocalStorageTradeRepository from '@/infrastructure/trade/repositories/LocalStorageTradeRepository';\n\n// vitest.setup.js already mocks ResizeObserver; no local FakeResizeObserver needed\n\n// Provide a minimal localStorage implementation for tests if missing\nbeforeAll(() => {\n  if (!window.localStorage || typeof window.localStorage.getItem !== 'function') {\n    const store: Record<string, string> = {};\n    const mock = {\n      getItem: (k: string) => (k in store ? store[k] : null),\n      setItem: (k: string, v: string) => {\n        store[k] = String(v);\n      },\n      removeItem: (k: string) => {\n        delete store[k];\n      },\n      clear: () => {\n        Object.keys(store).forEach((k) => delete store[k]);\n      },\n      key: (i: number) => Object.keys(store)[i] || null,\n      get length() {\n        return Object.keys(store).length;\n      },\n    };\n    Object.defineProperty(window, 'localStorage', { value: mock, configurable: true });\n  }\n});\n\nbeforeEach(() => {\n  try {\n    window.localStorage.removeItem('mt_user_settings_v1');\n    window.localStorage.removeItem('mt_trades_v1');\n  } catch (e) {\n    // ignore if localStorage not available\n  }\n});\n\ndescribe('Settings Switch and TradeJournal debug banner', () => {\n  it('toggles debug UI in localStorage and TradeJournal shows debug banner', async () => {\n    render(<Settings />);\n    // find the switch by role\n    const switchBtn = (await screen.findByRole('switch')) as HTMLElement;\n    expect(switchBtn).toBeTruthy();\n\n    // click to enable\n    fireEvent.click(switchBtn);\n\n    // assert localStorage was updated\n    const raw = window.localStorage.getItem('mt_user_settings_v1');\n    expect(raw).not.toBeNull();\n    const parsed = JSON.parse(raw!);\n    expect(parsed.debugUI).toBe(true);\n\n    // render TradeJournal with a repo and expect debug banner visible\n    render(<TradeJournal repo={new LocalStorageTradeRepository()} />);\n    const banner = await screen.findByText(/trades loaded/i);\n    expect(banner).toBeTruthy();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/settings/Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":106,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":144,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport styles from './Settings.module.css';\nimport { ThemeSwitcher } from '@/presentation/shared/components/ThemeSwitcher/ThemeSwitcher';\nimport { loadSettings, saveSettings } from './settingsStorage';\nimport { Button } from '@/presentation/shared/components/Button/Button';\nimport { ConfirmDialog } from '@/presentation/shared/components/ConfirmDialog/ConfirmDialog';\nimport { COMBINED_MOCK_TRADES } from '@/infrastructure/trade/repositories/mockData';\n\nfunction DebugToggle() {\n  const [enabled, setEnabled] = React.useState<boolean>(() => {\n    const s = loadSettings();\n    // if env var is set, treat as default but still allow user override\n    const envDefault =\n      typeof process !== 'undefined' &&\n      (process.env.REACT_APP_DEBUG_UI === 'true' || process.env.NODE_ENV === 'development');\n    return typeof s.debugUI === 'boolean' ? s.debugUI : envDefault;\n  });\n\n  const onToggle = (v: boolean) => {\n    setEnabled(v);\n    const s = loadSettings();\n    saveSettings({ ...s, debugUI: v });\n  };\n\n  return (\n    <div className={styles.debugRow}>\n      <label className={styles.fieldLabel}>Debug UI</label>\n      <div>\n        <button\n          role=\"switch\"\n          aria-checked={enabled}\n          aria-label=\"Toggle debug UI\"\n          className={`${styles.debugBtn} ${enabled ? styles.on : styles.off}`}\n          onClick={() => onToggle(!enabled)}\n          type=\"button\"\n        >\n          {enabled ? 'Debug ON' : 'Debug OFF'}\n        </button>\n      </div>\n      <p className={styles.help}>\n        Enable developer UI features (status banners, extra logs). Stored in browser settings.\n      </p>\n    </div>\n  );\n}\n\nfunction MockLoaderToggle() {\n  const [enabled, setEnabled] = React.useState<boolean>(() => {\n    const s = loadSettings();\n    // default: show the Load mock data button unless user explicitly disables it\n    return typeof s.showLoadMockButton === 'boolean' ? s.showLoadMockButton : true;\n  });\n\n  const onToggle = (v: boolean) => {\n    setEnabled(v);\n    const s = loadSettings();\n    saveSettings({ ...s, showLoadMockButton: v });\n  };\n\n  return (\n    <div className={styles.debugRow}>\n      <label className={styles.fieldLabel}>Show \"Load mock data\"</label>\n      <div>\n        <button\n          aria-checked={enabled}\n          aria-label=\"Toggle show load mock button\"\n          className={`${styles.debugBtn} ${enabled ? styles.on : styles.off}`}\n          onClick={() => onToggle(!enabled)}\n          type=\"button\"\n        >\n          {enabled ? 'Visible' : 'Hidden'}\n        </button>\n      </div>\n      <p className={styles.help}>\n        Show or hide the \"Load mock data\" control in the Trading Journal. Stored in browser\n        settings.\n      </p>\n    </div>\n  );\n}\n\nfunction StorageControls() {\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\n  const [confirmAction, setConfirmAction] = React.useState<'clear' | 'restore' | null>(null);\n  const [infoMessage, setInfoMessage] = React.useState<string | null>(null);\n  const infoTimerRef = React.useRef<number | null>(null);\n\n  const openConfirm = (action: 'clear' | 'restore') => {\n    setConfirmAction(action);\n    setConfirmOpen(true);\n  };\n\n  const onConfirm = async () => {\n    if (!confirmAction) {\n      setConfirmOpen(false);\n      return;\n    }\n    try {\n      if (confirmAction === 'clear') {\n        // count existing stored trades before clearing\n        const raw = localStorage.getItem('mt_trades_v1');\n        let count = 0;\n        try {\n          const parsed = raw ? JSON.parse(raw) : [];\n          if (Array.isArray(parsed)) count = parsed.length;\n        } catch (_e) {\n          count = 0;\n        }\n        localStorage.removeItem('mt_trades_v1');\n        setInfoMessage(`Deleted ${count} stored trade${count === 1 ? '' : 's'}`);\n        // keep message visible briefly then reload\n        if (infoTimerRef.current) window.clearTimeout(infoTimerRef.current);\n        infoTimerRef.current = window.setTimeout(\n          () => window.location.reload(),\n          1200\n        ) as unknown as number;\n      } else if (confirmAction === 'restore') {\n        const count = Array.isArray(COMBINED_MOCK_TRADES) ? COMBINED_MOCK_TRADES.length : 0;\n        localStorage.setItem('mt_trades_v1', JSON.stringify(COMBINED_MOCK_TRADES));\n        setInfoMessage(`Loaded ${count} demo trade${count === 1 ? '' : 's'}`);\n        if (infoTimerRef.current) window.clearTimeout(infoTimerRef.current);\n        infoTimerRef.current = window.setTimeout(\n          () => window.location.reload(),\n          1200\n        ) as unknown as number;\n      }\n    } finally {\n      setConfirmOpen(false);\n      setConfirmAction(null);\n    }\n  };\n\n  const onCancel = () => {\n    setConfirmOpen(false);\n    setConfirmAction(null);\n  };\n\n  // Clean up any pending info timer on unmount\n  React.useEffect(() => {\n    return () => {\n      if (infoTimerRef.current) {\n        try {\n          window.clearTimeout(infoTimerRef.current);\n        } catch (_e) {\n          /* ignore */\n        }\n        infoTimerRef.current = null;\n      }\n    };\n  }, []);\n\n  const clearStoredTrades = () => {\n    openConfirm('clear');\n  };\n\n  const restoreDemoData = () => {\n    openConfirm('restore');\n  };\n\n  return (\n    <div className={styles.debugRow} style={{ alignItems: 'center' }}>\n      <label className={styles.fieldLabel}>Storage</label>\n      <div className={styles.storageButtons}>\n        <Button variant=\"danger\" onClick={clearStoredTrades}>\n          Delete demo data\n        </Button>\n        <Button variant=\"primary\" onClick={restoreDemoData}>\n          Add demo data\n        </Button>\n      </div>\n      <ConfirmDialog\n        open={confirmOpen}\n        title={confirmAction === 'clear' ? 'Delete demo data' : 'Add demo data'}\n        message={\n          confirmAction === 'clear'\n            ? 'Alle gespeicherten Trades entfernen? Diese Aktion kann nicht rckgngig gemacht werden.'\n            : 'Demo-Daten wiederherstellen? Existierende Daten werden berschrieben.'\n        }\n        confirmLabel={confirmAction === 'clear' ? 'Lschen' : 'Wiederherstellen'}\n        cancelLabel=\"Abbrechen\"\n        onConfirm={onConfirm}\n        onCancel={onCancel}\n        confirmVariant={confirmAction === 'clear' ? 'danger' : 'primary'}\n      />\n      <p className={styles.help}>\n        Remove or restore the demo trades stored in your browser localStorage (key: mt_trades_v1).\n      </p>\n      {/* transitory info banner (placed below the description as requested) */}\n      {infoMessage && (\n        <div role=\"status\" aria-live=\"polite\" className={styles.infoBanner}>\n          {infoMessage}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport function Settings({ compactView }: { compactView?: boolean }) {\n  return (\n    <div\n      className={compactView ? `${styles.container} ${styles.compact}` : styles.container}\n      data-compact={compactView}\n    >\n      <h2>Settings</h2>\n\n      <section className={styles.section}>\n        <h3>Look & Feel</h3>\n        <p className={styles.help}>\n          Choose a theme to apply the color scheme across the app. This setting is saved to your\n          browser.\n        </p>\n        <div className={styles.themeRow}>\n          <ThemeSwitcher />\n        </div>\n      </section>\n\n      <section className={styles.section}>\n        <h3>Debug</h3>\n        <DebugToggle />\n        <MockLoaderToggle />\n        <StorageControls />\n      </section>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/settings/settingsStorage.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[343,388],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[555,600],"text":""},"desc":"Remove the console.warn()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const SETTINGS_KEY = 'mt_user_settings_v1';\n\nexport type UserSettings = {\n  debugUI?: boolean;\n  showLoadMockButton?: boolean;\n};\n\nexport function loadSettings(): UserSettings {\n  try {\n    const raw = window.localStorage.getItem(SETTINGS_KEY);\n    if (!raw) return {};\n    return JSON.parse(raw) as UserSettings;\n  } catch (err) {\n    console.warn('Failed to load settings', err);\n    return {};\n  }\n}\n\nexport function saveSettings(s: UserSettings) {\n  try {\n    window.localStorage.setItem(SETTINGS_KEY, JSON.stringify(s));\n  } catch (err) {\n    console.warn('Failed to save settings', err);\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Button/Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Card/Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/ConfirmDialog/ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Header/Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Input/Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Layout/Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/MarketSelect/MarketSelect.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/MarketSelect/MarketSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/SideSelect/SideSelect.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/SideSelect/SideSelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":97,"column":11,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":97,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2531,2534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2531,2534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport styles from './SideSelect.module.css';\nimport inputStyles from '@/presentation/shared/components/Input/Input.module.css';\n\nexport type SideValue = 'LONG' | 'SHORT';\n\nexport type SideSelectProps = {\n  value: SideValue;\n  onChange: (value: SideValue) => void;\n  ariaLabel?: string;\n  showBadge?: boolean;\n  compact?: boolean;\n  onBlur?: (event: React.FocusEvent<HTMLSelectElement>) => void;\n  colored?: boolean;\n  label?: string;\n  hasError?: boolean;\n  ariaDescribedBy?: string;\n  className?: string;\n};\n\nexport function SideSelect({\n  value,\n  onChange,\n  ariaLabel,\n  showBadge = false,\n  compact = false,\n  onBlur,\n  colored = false,\n  label,\n  hasError = false,\n  ariaDescribedBy,\n  className,\n}: SideSelectProps) {\n  const baseClass = compact ? `${styles.select} ${styles.selectCompact}` : styles.select;\n  const coloredClass = colored\n    ? value === 'LONG'\n      ? `${baseClass} ${styles.colored} ${styles.coloredLong}`\n      : `${baseClass} ${styles.colored} ${styles.coloredShort}`\n    : baseClass;\n  const selectClass = `${coloredClass} ${hasError ? styles.error : ''}`.trim();\n\n  const containerClass = [styles.container, className ? styles.containerFull : '']\n    .filter(Boolean)\n    .join(' ');\n\n  const control = (\n    <div className={containerClass}>\n      <select\n        className={[selectClass, className].filter(Boolean).join(' ')}\n        value={value}\n        onChange={(e) => onChange(e.target.value as SideValue)}\n        onBlur={onBlur}\n        aria-label={ariaLabel}\n        aria-describedby={ariaDescribedBy}\n      >\n        <option value=\"LONG\">LONG</option>\n        <option value=\"SHORT\">SHORT</option>\n      </select>\n      {showBadge && (\n        <span\n          className={`${styles.badge} ${value === 'LONG' ? styles.badgeLong : styles.badgeShort}`}\n          aria-hidden\n        >\n          {value}\n        </span>\n      )}\n    </div>\n  );\n\n  if (label) {\n    return (\n      <label className={inputStyles.wrapper}>\n        <span className={inputStyles.label}>{label}</span>\n        {control}\n      </label>\n    );\n  }\n\n  return control;\n}\n\nexport type SideBadgeProps = {\n  value: SideValue;\n  className?: string;\n  onClick?: (e: React.MouseEvent) => void;\n};\n\nexport function SideBadge({ value, className = '', onClick }: SideBadgeProps) {\n  return (\n    <span\n      role=\"button\"\n      tabIndex={0}\n      onClick={onClick}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          onClick && onClick(e as any);\n        }\n      }}\n      className={`${styles.badge} ${\n        value === 'LONG' ? styles.badgeLong : styles.badgeShort\n      } ${className}`}\n    >\n      {value}\n    </span>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/StatusBadge/StatusBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":27,"column":11,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":27,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[709,712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[709,712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport styles from './StatusBadge.module.css';\n\nexport type StatusValue = 'OPEN' | 'CLOSED' | 'FILLED';\n\nexport type StatusBadgeProps = {\n  value: StatusValue;\n  className?: string;\n  onClick?: (e: React.MouseEvent) => void;\n};\n\nexport function StatusBadge({ value, className = '', onClick }: StatusBadgeProps) {\n  const cls =\n    value === 'OPEN'\n      ? styles.statusOpen\n      : value === 'FILLED'\n      ? styles.statusFilled\n      : styles.statusClosed;\n  return (\n    <span\n      role=\"button\"\n      tabIndex={0}\n      onClick={onClick}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          onClick && onClick(e as any);\n        }\n      }}\n      className={`${cls} ${className}`}\n    >\n      {value}\n    </span>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/StatusSelect/StatusSelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":53,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport styles from './StatusSelect.module.css';\nimport inputStyles from '@/presentation/shared/components/Input/Input.module.css';\n\nexport type StatusValue = 'OPEN' | 'CLOSED' | 'FILLED';\n\nexport type StatusSelectProps = {\n  value: StatusValue;\n  onChange: (value: StatusValue) => void;\n  ariaLabel?: string;\n  compact?: boolean;\n  colored?: boolean;\n  onBlur?: (e: React.FocusEvent<HTMLSelectElement>) => void;\n  autoFocus?: boolean;\n  label?: string;\n  hasError?: boolean;\n  ariaDescribedBy?: string;\n};\n\nexport function StatusSelect({\n  value,\n  onChange,\n  ariaLabel,\n  compact = false,\n  colored = true,\n  onBlur,\n  autoFocus = false,\n  label,\n  hasError = false,\n  ariaDescribedBy,\n}: StatusSelectProps) {\n  const baseClass = compact ? `${styles.select} ${styles.selectCompact}` : styles.select;\n  const coloredClass = colored\n    ? value === 'OPEN'\n      ? `${baseClass} ${styles.colored} ${styles.coloredOpen}`\n      : value === 'CLOSED'\n      ? `${baseClass} ${styles.colored} ${styles.coloredClosed}`\n      : `${baseClass} ${styles.colored} ${styles.coloredFilled}`\n    : baseClass;\n\n  const selectClass = `${coloredClass} ${hasError ? styles.error : ''}`.trim();\n\n  const control = (\n    <select\n      className={selectClass}\n      value={value}\n      onChange={(e) => {\n        const v = e.target.value as StatusValue;\n        onChange(v);\n        // blur immediately after selection so parent onBlur handlers run and edit mode is closed reliably\n        try {\n          (e.currentTarget as HTMLSelectElement).blur();\n        } catch (err) {\n          /* ignore */\n        }\n      }}\n      aria-label={ariaLabel}\n      onBlur={onBlur}\n      autoFocus={autoFocus}\n      aria-describedby={ariaDescribedBy}\n    >\n      <option value=\"OPEN\">OPEN</option>\n      <option value=\"CLOSED\">CLOSED</option>\n      <option value=\"FILLED\">FILLED</option>\n    </select>\n  );\n\n  if (label) {\n    return (\n      <label className={inputStyles.wrapper}>\n        <span className={inputStyles.label}>{label}</span>\n        {control}\n      </label>\n    );\n  }\n\n  return control;\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/Switch/Switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/shared/components/ThemeSwitcher/ThemeSwitcher.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":39,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport styles from './ThemeSwitcher.module.css';\n\nconst THEMES = [\n  'nightscope',\n  'warmledger',\n  'datagrid',\n  'solarized',\n  'neon',\n  'forest',\n  'sunrise',\n  'mono',\n  'aurora',\n] as const;\nexport type ThemeName = (typeof THEMES)[number];\n\nconst SWATCH: Record<ThemeName, string> = {\n  nightscope: 'linear-gradient(90deg,#58d68d,#00bcd4)',\n  warmledger: 'linear-gradient(90deg,#f7b267,#f26d3d)',\n  datagrid: 'linear-gradient(90deg,#4fb3ff,#2b8bff)',\n  solarized: 'linear-gradient(90deg,#2aa198,#b58900)',\n  neon: 'linear-gradient(90deg,#ff2dd4,#00ffd5)',\n  forest: 'linear-gradient(90deg,#79c267,#2e8b57)',\n  sunrise: 'linear-gradient(90deg,#ff7a59,#ffd166)',\n  mono: 'linear-gradient(90deg,#cfcfcf,#9a9a9a)',\n  aurora: 'linear-gradient(90deg,#8b5cf6,#3de7c9,#ffd27a)',\n};\n\nexport function ThemeSwitcher() {\n  const [current, setCurrent] = useState<ThemeName>(\n    () => (localStorage.getItem('theme') as ThemeName) || 'nightscope'\n  );\n\n  useEffect(() => {\n    // apply theme to document and persist\n    document.documentElement.setAttribute('data-theme', current);\n    try {\n      localStorage.setItem('theme', current);\n    } catch (e) {\n      // ignore if localStorage is not available\n    }\n  }, [current]);\n\n  const setTheme = (t: ThemeName) => {\n    setCurrent(t);\n  };\n\n  return (\n    <div className={styles.switcher} role=\"toolbar\" aria-label=\"Theme switcher\">\n      {THEMES.map((t) => (\n        <button\n          key={t}\n          className={[styles.btn, current === t ? styles.active : ''].filter(Boolean).join(' ')}\n          onClick={() => setTheme(t)}\n          title={t}\n        >\n          <span className={styles.swatch} style={{ background: SWATCH[t] }} aria-hidden />\n          <span className={styles.label}>{t}</span>\n        </button>\n      ))}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeDetail/TradeDetailEditor.compact.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from '@testing-library/react';\nimport { describe, it, expect } from 'vitest';\nimport { TradeDetailEditor } from './TradeDetailEditor';\n\nconst mockTrade = {\n  id: 't1',\n  symbol: 'BTCUSD',\n  entryDate: '2025-01-01T00:00:00Z',\n  size: 1,\n  price: 10000,\n  side: 'LONG',\n  margin: 100,\n};\n\ndescribe('TradeDetailEditor compact', () => {\n  it('applies compact class and renders save button with saveBtn class', () => {\n    render(<TradeDetailEditor trade={mockTrade as any} compactView onSave={async () => {}} />);\n\n    const root = screen.getByText('BTCUSD').closest('div');\n    // root should have class that includes 'compact' (module class name may be hashed, but our module exports 'compact')\n    expect(root).toBeDefined();\n    // Find Save button\n    const save = screen.getByRole('button', { name: /save now/i });\n    expect(save).toBeDefined();\n    // Assert className includes 'saveBtn'\n    expect(save.className).toMatch(/saveBtn/);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeDetail/TradeDetailEditor.delete.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[570,573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[570,573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[993,996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[993,996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { vi } from 'vitest';\nimport { TradeDetailEditor } from './TradeDetailEditor';\n\nconst sample = {\n  id: 't1',\n  symbol: 'ETHUSD',\n  entryDate: '2025-12-21T10:12:00Z',\n  size: 0.51,\n  price: 1800.5,\n  side: 'SHORT',\n  notes: 'Scalp-Short nach Fehlausbruch.',\n};\n\ndescribe('TradeDetailEditor delete flow', () => {\n  it('calls onDelete with the trade id when Delete clicked', async () => {\n    const onDelete = vi.fn(() => Promise.resolve());\n    render(<TradeDetailEditor trade={sample as any} onDelete={onDelete} onSave={async () => {}} />);\n\n    // find Delete button\n    const deleteButton = screen.getByRole('button', { name: /delete/i }) as HTMLButtonElement;\n    expect(deleteButton).toBeTruthy();\n\n    // click delete\n    fireEvent.click(deleteButton);\n\n    // expect onDelete called with id\n    await waitFor(() => {\n      expect(onDelete).toHaveBeenCalled();\n    });\n    const calledWith = (onDelete as any).mock?.calls?.[0]?.[0];\n    expect(calledWith).toBe('t1');\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeDetail/TradeDetailEditor.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[557,560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[557,560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1227,1230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1227,1230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { vi } from 'vitest';\nimport { TradeDetailEditor } from './TradeDetailEditor';\n\nconst sample = {\n  id: 't1',\n  symbol: 'ETHUSD',\n  entryDate: '2025-12-21T10:12:00Z',\n  size: 0.51,\n  price: 1800.5,\n  side: 'SHORT',\n  notes: 'Scalp-Short nach Fehlausbruch.',\n};\n\ndescribe('TradeDetailEditor', () => {\n  it('calls onSave with updated trade when Save now clicked', async () => {\n    const onSave = vi.fn(() => Promise.resolve());\n    render(<TradeDetailEditor trade={sample as any} onSave={onSave} />);\n\n    // change price\n    const priceInput = screen.getByLabelText('Price') as HTMLInputElement;\n    fireEvent.change(priceInput, { target: { value: '1900.5' } });\n\n    // Save button should be enabled\n    const saveButton = screen.getByRole('button', { name: /Save now/i }) as HTMLButtonElement;\n    expect(saveButton.disabled).toBe(false);\n\n    // click save\n    fireEvent.click(saveButton);\n\n    // onSave called with updated price (wait for async handler)\n    await waitFor(() => {\n      expect(onSave).toHaveBeenCalled();\n    });\n    // read mock call args using `any` cast to avoid TS mismatches in build\n    const calledWith = (onSave as any).mock?.calls?.[0]?.[0];\n    expect(calledWith.price).toBe(1900.5);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeDetail/TradeDetailEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":59,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7384,7387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7384,7387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7471,7474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7471,7474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7481,7484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7481,7484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useMemo, useRef } from 'react';\nimport type { TradeInput } from '@/domain/trade/entities/TradeFactory';\nimport { validateTrade } from '@/presentation/trade/validation';\nimport { mapTradeError } from '@/presentation/trade/errorMapper';\nimport styles from './TradeDetailEditor.module.css';\nimport { Button } from '@/presentation/shared/components/Button/Button';\nimport { SideSelect, type SideValue } from '@/presentation/shared/components/SideSelect/SideSelect';\nimport {\n  StatusSelect,\n  type StatusValue,\n} from '@/presentation/shared/components/StatusSelect/StatusSelect';\n\nexport type TradeDetailEditorProps = {\n  trade: TradeInput | null;\n  onChange?: (t: TradeInput) => void;\n  onSave?: (t: TradeInput) => Promise<void>;\n  onDelete?: (id: string) => Promise<void>;\n  compactView?: boolean;\n};\n\nexport function TradeDetailEditor({\n  trade,\n  onChange,\n  onSave,\n  onDelete,\n  compactView = false,\n}: TradeDetailEditorProps) {\n  const [local, setLocal] = useState<TradeInput | null>(trade);\n  const [errors, setErrors] = useState<Record<string, string | undefined>>({});\n  const [status, setStatus] = useState<'idle' | 'saving' | 'saved' | 'failed'>('idle');\n\n  useEffect(() => {\n    setLocal(trade);\n    setErrors({});\n    setStatus('idle');\n  }, [trade?.id]);\n\n  // Keep an immutable snapshot of the trade as it was when loaded into the editor.\n  // This avoids a race where parent onChange updates the canonical trade object\n  // and causes a JSON-equality check against `trade` to reset the dirty flag.\n  const initialTradeRef = useRef<TradeInput | null>(trade ?? null);\n  useEffect(() => {\n    initialTradeRef.current = trade ?? null;\n  }, [trade?.id]);\n\n  useEffect(() => {\n    // notify parent immediately on change so parent can keep canonical list\n    if (local && onChange) onChange(local);\n  }, [local, onChange]);\n\n  const validation = useMemo(() => (local ? validateTrade(local) : {}), [local]);\n  const hasValidationErrors = Object.values(validation).some(Boolean);\n  const isDirty = useMemo(() => {\n    if (!local) return false;\n    const base = initialTradeRef.current;\n    if (!base) return true;\n    try {\n      return JSON.stringify(local) !== JSON.stringify(base);\n    } catch (_e) {\n      return true;\n    }\n  }, [local, /* initialTradeRef is stable */ hasValidationErrors]);\n\n  if (!local)\n    return (\n      <div className={styles.empty}>\n        <div style={{ fontSize: 16, fontWeight: 700, marginBottom: 8 }}>Kein Trade ausgewhlt</div>\n        <div style={{ color: 'var(--muted)', marginBottom: 12 }}>\n          Whle einen Trade aus der Liste, um ihn hier anzusehen oder zu bearbeiten. Du kannst auch\n          einen neuen Trade anlegen und anschlieend die Details hier vervollstndigen.\n        </div>\n        <ul style={{ color: 'var(--muted)', marginLeft: 16 }}>\n          <li>Ein Trade in der linken Liste anklicken, um Details zu laden.</li>\n          <li>Im Formular links einen neuen Trade anlegen (Add) und hier nachbearbeiten.</li>\n          <li>\n            nderungen werden beim Verlassen eines Felds (onBlur) validiert und knnen mit \"Save\n            now\" gespeichert werden.\n          </li>\n        </ul>\n      </div>\n    );\n\n  const fieldChange = <K extends keyof TradeInput>(key: K, value: TradeInput[K]) => {\n    setLocal((prev) => (prev ? { ...prev, [key]: value } : prev));\n    setStatus('idle');\n  };\n\n  // Restore the editor contents to the initial loaded trade snapshot\n  const restoreInitial = () => {\n    const base = initialTradeRef.current;\n    if (!base) return;\n    // create a defensive clone so editors won't accidentally mutate the ref\n    const clone: TradeInput = JSON.parse(JSON.stringify(base));\n    setLocal(clone);\n    setErrors({});\n    setStatus('idle');\n    if (onChange) onChange(clone);\n  };\n\n  const handleBlurOrSave = async () => {\n    if (!local) return;\n    const v = validateTrade(local);\n    const hasErrors = Object.values(v).some(Boolean);\n    setErrors(v);\n    if (hasErrors) return;\n    if (!onSave) return;\n\n    setStatus('saving');\n    try {\n      await onSave(local);\n      setStatus('saved');\n      setTimeout(() => setStatus('idle'), 1200);\n    } catch (err) {\n      const mapped = mapTradeError(err);\n      if (mapped.field) {\n        const field = mapped.field;\n        setErrors((prev) => ({ ...prev, [field]: mapped.message }));\n      }\n      setStatus('failed');\n      throw err;\n    }\n  };\n\n  const saveDisabled = status === 'saving' || !isDirty || hasValidationErrors || !onSave;\n\n  return (\n    <div className={`${styles.editor} ${compactView ? styles.compact : ''}`} aria-live=\"polite\">\n      <div className={styles.header}>\n        <div className={styles.title}>\n          {local.symbol} <span className={styles.sub}>#{local.id}</span>\n        </div>\n        <div className={styles.saveStatus} aria-hidden={status === 'idle'}>\n          {status === 'saving'\n            ? 'Saving'\n            : status === 'saved'\n            ? 'Saved'\n            : status === 'failed'\n            ? 'Failed'\n            : ''}\n        </div>\n      </div>\n\n      <div className={styles.form}>\n        <label className={styles.label}>Symbol</label>\n        <input\n          aria-label=\"Symbol\"\n          className={styles.input}\n          value={local.symbol}\n          onChange={(e) => fieldChange('symbol', e.target.value)}\n          onBlur={handleBlurOrSave}\n        />\n        {errors.symbol && <div className={styles.fieldError}>{errors.symbol}</div>}\n\n        <label className={styles.label}>Entry Date</label>\n        <input\n          aria-label=\"Entry Date\"\n          className={styles.input}\n          type=\"datetime-local\"\n          value={local.entryDate}\n          onChange={(e) => fieldChange('entryDate', e.target.value)}\n          onBlur={handleBlurOrSave}\n        />\n        {errors.entryDate && <div className={styles.fieldError}>{errors.entryDate}</div>}\n\n        <label className={styles.label}>Size</label>\n        <input\n          aria-label=\"Size\"\n          className={styles.input}\n          type=\"number\"\n          value={local.size}\n          onChange={(e) => fieldChange('size', Number(e.target.value))}\n          onBlur={handleBlurOrSave}\n        />\n        {errors.size && <div className={styles.fieldError}>{errors.size}</div>}\n\n        <label className={styles.label}>Price</label>\n        <input\n          aria-label=\"Price\"\n          className={styles.input}\n          type=\"number\"\n          value={local.price}\n          onChange={(e) => fieldChange('price', Number(e.target.value))}\n          onBlur={handleBlurOrSave}\n        />\n        {errors.price && <div className={styles.fieldError}>{errors.price}</div>}\n\n        <label className={styles.label}>Side</label>\n        <SideSelect\n          value={local.side as SideValue}\n          onChange={(v: SideValue) => fieldChange('side', v)}\n          ariaLabel=\"Trade side\"\n          showBadge={false}\n          colored\n          onBlur={() => handleBlurOrSave()}\n          hasError={Boolean(errors.side)}\n          ariaDescribedBy={errors.side ? 'detail-side-error' : undefined}\n          className={styles.input}\n        />\n        {errors.side && (\n          <div id=\"detail-side-error\" className={styles.fieldError}>\n            {errors.side}\n          </div>\n        )}\n\n        <label className={styles.label}>Status</label>\n        <StatusSelect\n          value={(local as any).status ?? 'OPEN'}\n          onChange={(v: StatusValue) => fieldChange('status' as any, v as any)}\n          ariaLabel=\"Trade status\"\n          compact\n          colored\n          onBlur={() => handleBlurOrSave()}\n          hasError={Boolean(errors.status)}\n          ariaDescribedBy={errors.status ? 'detail-status-error' : undefined}\n        />\n        {errors.status && (\n          <div id=\"detail-status-error\" className={styles.fieldError}>\n            {errors.status}\n          </div>\n        )}\n\n        <label className={styles.label}>Notes</label>\n        <textarea\n          aria-label=\"Notes\"\n          className={styles.textarea}\n          value={local.notes ?? ''}\n          onChange={(e) => fieldChange('notes', e.target.value)}\n          onBlur={handleBlurOrSave}\n        />\n\n        <label className={styles.label}>TP1</label>\n        <input\n          aria-label=\"TP1\"\n          className={styles.input}\n          type=\"number\"\n          value={local.tp1 ?? ''}\n          onChange={(e) =>\n            fieldChange('tp1', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.tp1 && <div className={styles.fieldError}>{errors.tp1}</div>}\n\n        <label className={styles.label}>TP2</label>\n        <input\n          aria-label=\"TP2\"\n          className={styles.input}\n          type=\"number\"\n          value={local.tp2 ?? ''}\n          onChange={(e) =>\n            fieldChange('tp2', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.tp2 && <div className={styles.fieldError}>{errors.tp2}</div>}\n\n        <label className={styles.label}>TP3</label>\n        <input\n          aria-label=\"TP3\"\n          className={styles.input}\n          type=\"number\"\n          value={local.tp3 ?? ''}\n          onChange={(e) =>\n            fieldChange('tp3', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.tp3 && <div className={styles.fieldError}>{errors.tp3}</div>}\n\n        <label className={styles.label}>TP4</label>\n        <input\n          aria-label=\"TP4\"\n          className={styles.input}\n          type=\"number\"\n          value={local.tp4 ?? ''}\n          onChange={(e) =>\n            fieldChange('tp4', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.tp4 && <div className={styles.fieldError}>{errors.tp4}</div>}\n\n        <label className={styles.label}>Margin</label>\n        <input\n          aria-label=\"Margin\"\n          className={styles.input}\n          type=\"number\"\n          value={local.margin ?? ''}\n          onChange={(e) =>\n            fieldChange('margin', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.margin && <div className={styles.fieldError}>{errors.margin}</div>}\n\n        <label className={styles.label}>Leverage</label>\n        <input\n          aria-label=\"Leverage\"\n          className={styles.input}\n          type=\"number\"\n          value={local.leverage ?? ''}\n          onChange={(e) =>\n            fieldChange('leverage', e.target.value === '' ? undefined : Number(e.target.value))\n          }\n          onBlur={handleBlurOrSave}\n        />\n        {errors.leverage && <div className={styles.fieldError}>{errors.leverage}</div>}\n\n        <div style={{ marginTop: 12 }}>\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            onClick={restoreInitial}\n            disabled={!isDirty}\n            aria-disabled={!isDirty}\n            style={{ marginRight: 8 }}\n          >\n            Restore\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"primary\"\n            onClick={handleBlurOrSave}\n            disabled={saveDisabled}\n            aria-disabled={saveDisabled}\n            aria-busy={status === 'saving'}\n            className={`${styles.saveBtn} ${status === 'saving' ? styles.savingPulse : ''}`.trim()}\n          >\n            {status === 'saving' ? 'Saving' : status === 'saved' ? 'Saved' : 'Save now'}\n          </Button>\n          {onDelete && local && (\n            <Button\n              type=\"button\"\n              variant=\"danger\"\n              onClick={() => onDelete(local.id)}\n              className={styles.inlineDelete}\n              style={{ marginLeft: 8 }}\n            >\n              Delete\n            </Button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeJournal.compact.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'container' is assigned a value but never used.","line":10,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from '@testing-library/react';\nimport { describe, it, expect } from 'vitest';\nimport { TradeJournal } from './TradeJournal';\nimport InMemoryTradeRepository from '@/infrastructure/trade/repositories/InMemoryTradeRepository';\n\n// Force compact mode by using forceCompact prop\ndescribe('TradeJournal compact editor toggle', () => {\n  it('shows compact summary and toggles editor when Show details clicked', async () => {\n    const repo = new InMemoryTradeRepository();\n    const { container } = render(<TradeJournal repo={repo} forceCompact />);\n\n    // Wait for PositionCard symbols to render (compact view uses PositionCard)\n    const symbols = await screen.findAllByText(/USD$/, {}, { timeout: 1000 });\n    expect(symbols.length).toBeGreaterThan(0);\n\n    // Click the first PositionCard's expand button to select that trade (PositionCard exposes expand button)\n    const expandBtns = await screen.findAllByLabelText(/Toggle details for/i);\n    expect(expandBtns.length).toBeGreaterThan(0);\n    fireEvent.click(expandBtns[0]);\n\n    // Wait a tick to allow selection effect\n    await new Promise((r) => setTimeout(r, 10));\n\n    // Now the compact summary should show a Show details button\n    const show = await screen.findByRole('button', { name: /show details/i });\n    expect(show).toBeDefined();\n\n    // Click to open details\n    fireEvent.click(show);\n\n    // Save button in editor should be visible\n    const save = await screen.findByRole('button', { name: /save now/i });\n    expect(save).toBeDefined();\n\n    // Hide details\n    const hide = screen.getByRole('button', { name: /hide details/i });\n    fireEvent.click(hide);\n\n    expect(screen.queryByRole('button', { name: /save now/i })).toBeNull();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeJournal.entryDate.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'screen' is defined but never used.","line":1,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[423,426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[423,426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from '@testing-library/react';\nimport { TradeJournal } from './TradeJournal';\nimport InMemoryTradeRepository from '@/infrastructure/trade/repositories/InMemoryTradeRepository';\n\n// Mock ResizeObserver for jsdom environment used in tests\nclass FakeResizeObserver {\n  callback: any;\n  constructor(cb: any) {\n    this.callback = cb;\n  }\n  observe() {}\n  unobserve() {}\n  disconnect() {}\n}\n(global as any).ResizeObserver = FakeResizeObserver;\n\n// render with injected repo to avoid warnings\ndescribe('TradeJournal entryDate', () => {\n  it('prefills entryDate with current datetime (within 2 minutes)', async () => {\n    const { container } = render(<TradeJournal repo={new InMemoryTradeRepository()} />);\n\n    const entryInput = container.querySelector('#entryDate') as HTMLInputElement | null;\n    expect(entryInput).toBeTruthy();\n\n    // parse value and compare with now (allow 2 minute tolerance)\n    const val = entryInput!.value;\n    const parsed = new Date(val);\n    expect(isNaN(parsed.getTime())).toBe(false);\n\n    const now = new Date();\n    const diffMs = Math.abs(now.getTime() - parsed.getTime());\n    expect(diffMs).toBeLessThanOrEqual(2 * 60 * 1000); // 2 minutes\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeJournal.integration.test.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'priceInput' is never reassigned. Use 'const' instead.","line":88,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":88,"endColumn":19,"fix":{"range":[4476,4799],"text":"const priceInput = await screen\n      .findByLabelText('Price', {}, { timeout: 2000 })\n      .catch(async (err) => {\n        // Debug: dump some DOM for inspection\n        // eslint-disable-next-line no-console\n        console.error('DEBUG DOM snapshot:', document.body.innerHTML.slice(0, 2000));\n        throw err;\n      });"}}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4693,4770],"text":""},"desc":"Remove the console.error()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor, within } from '@testing-library/react';\nimport { describe, it, expect } from 'vitest';\nimport { TradeJournal } from './TradeJournal';\nimport InMemoryTradeRepository from '@/infrastructure/trade/repositories/InMemoryTradeRepository';\n\n// Integration test for the full Trading Journal screen (desktop & compact)\ndescribe('TradeJournal Integration', () => {\n  it('allows creating, editing, filtering, and deleting trades (desktop)', async () => {\n    const repo = new InMemoryTradeRepository();\n    render(<TradeJournal repo={repo} />);\n\n    // Add a new trade with a unique symbol to avoid colliding with mock data in repo\n    const newSymbol = 'EURUSD-INT';\n    // Add a new trade\n    fireEvent.change(screen.getByLabelText(/Symbol/i), { target: { value: newSymbol } });\n    fireEvent.change(screen.getByLabelText(/Entry Price/i), { target: { value: '1.118' } });\n    fireEvent.change(screen.getByLabelText(/Position Size/i), { target: { value: '12000' } });\n    fireEvent.change(screen.getByLabelText(/Margin/i), { target: { value: '110' } });\n    fireEvent.change(screen.getByLabelText(/Leverage/i), { target: { value: '20' } });\n    fireEvent.change(screen.getByLabelText(/Stop Loss/i), { target: { value: '1.112' } });\n    fireEvent.change(screen.getByLabelText(/TP1/i), { target: { value: '1.112' } });\n    fireEvent.change(screen.getByLabelText(/TP2/i), { target: { value: '1.108' } });\n    fireEvent.change(screen.getByLabelText(/TP3/i), { target: { value: '1.102' } });\n    fireEvent.change(screen.getByLabelText(/TP4/i), { target: { value: '1.098' } });\n    fireEvent.change(screen.getByLabelText(/Notes/i), { target: { value: 'Breakdown' } });\n    fireEvent.click(screen.getByRole('button', { name: /Add/i }));\n\n    // Trade should appear in the list\n    await screen.findByText(newSymbol);\n    // Es gibt mehrere mgliche EURUSD entries in mock data, prfe, dass unser neuen Symbol sichtbar ist\n    expect(screen.getAllByText(newSymbol).length).toBeGreaterThan(0);\n\n    // Select the trade using multiple strategies to support desktop and compact layouts:\n    // 1) explicit `Select <symbol>` button (non-compact)\n    // 2) PositionCard expand/toggle button `Toggle details for <symbol>` (compact)\n    // 3) fallback: click the listitem that contains the symbol\n    const selectBtn = screen.queryByRole('button', {\n      name: new RegExp(`^Select ${newSymbol}$`, 'i'),\n    });\n    if (selectBtn) {\n      fireEvent.click(selectBtn);\n    } else {\n      // Prefer selecting inside the trade list to avoid matching the NewTrade form\n      const tradeList = screen.getByRole('list');\n      // support both listitem (desktop) and group (compact) containers\n      const listItems = within(tradeList).queryAllByRole('listitem');\n      const groupItems = within(tradeList).queryAllByRole('group');\n      const containers = [...listItems, ...groupItems];\n      let clicked = false;\n      for (const container of containers) {\n        if (within(container).queryByText(newSymbol)) {\n          // try to find a local toggle/expand button inside this container\n          const localToggles = within(container).queryAllByLabelText(\n            new RegExp(`Toggle details for ${newSymbol}`, 'i')\n          );\n          if (localToggles.length > 0) {\n            fireEvent.click(localToggles[0]);\n            clicked = true;\n            break;\n          }\n          // else click the container itself (if it's an interactive element)\n          if (container.tagName === 'BUTTON' || container.getAttribute('role') === 'listitem') {\n            fireEvent.click(container);\n            clicked = true;\n            break;\n          }\n        }\n      }\n      // Fallback: if none found inside list, try a global toggle\n      if (!clicked) {\n        const globalToggles = screen.queryAllByLabelText(\n          new RegExp(`Toggle details for ${newSymbol}`, 'i')\n        );\n        if (globalToggles.length > 0) {\n          fireEvent.click(globalToggles[0]);\n          clicked = true;\n        }\n      }\n      expect(clicked).toBe(true);\n    }\n\n    // If compact summary was shown, click the 'Show details' button to render the full editor\n    const showDetailsBtn = screen.queryByRole('button', { name: /show details/i });\n    if (showDetailsBtn) fireEvent.click(showDetailsBtn);\n\n    // Now the editor should be visible in the right pane  find the Price input by aria-label\n    // Use findByLabelText which waits for the element to appear\n    let priceInput = await screen\n      .findByLabelText('Price', {}, { timeout: 2000 })\n      .catch(async (err) => {\n        // Debug: dump some DOM for inspection\n        // eslint-disable-next-line no-console\n        console.error('DEBUG DOM snapshot:', document.body.innerHTML.slice(0, 2000));\n        throw err;\n      });\n    fireEvent.change(priceInput as HTMLInputElement, { target: { value: '1.120' } });\n    fireEvent.click(screen.getByRole('button', { name: /Save now/i }));\n    await screen.findByDisplayValue('1.120');\n\n    // Filter by status\n    fireEvent.click(screen.getByRole('button', { name: /Open/i }));\n    // After filtering, ensure our unique symbol still appears\n    expect((await screen.findAllByText(newSymbol)).length).toBeGreaterThan(0);\n\n    // Delete the trade\n    // After deletion, expect the count of our symbol to decrease\n    const beforeCount = (await screen.findAllByText(newSymbol)).length;\n    fireEvent.click(screen.getByRole('button', { name: /Delete/i }));\n    fireEvent.click(screen.getByRole('button', { name: /Ja/i })); // Confirm dialog\n    await waitFor(() =>\n      expect((screen.queryAllByText(newSymbol).length || 0) < beforeCount).toBeTruthy()\n    );\n  });\n\n  it('renders and interacts correctly in compactView (mobile/forceCompact)', async () => {\n    const repo = new InMemoryTradeRepository();\n    render(<TradeJournal repo={repo} forceCompact />);\n\n    // Add a new trade (open modal if needed)\n    fireEvent.change(screen.getByLabelText(/Symbol/i), { target: { value: 'GBPUSD' } });\n    fireEvent.change(screen.getByLabelText(/Entry Price/i), { target: { value: '1.250' } });\n    fireEvent.change(screen.getByLabelText(/Position Size/i), { target: { value: '10000' } });\n    fireEvent.change(screen.getByLabelText(/Margin/i), { target: { value: '100' } });\n    fireEvent.change(screen.getByLabelText(/Leverage/i), { target: { value: '10' } });\n    fireEvent.change(screen.getByLabelText(/Stop Loss/i), { target: { value: '1.200' } });\n    fireEvent.click(screen.getByRole('button', { name: /Add/i }));\n\n    // Trade should appear in the compact list\n    await screen.findByText('GBPUSD');\n    // Es gibt mehrere GBPUSD, daher explizit alle prfen\n    expect(screen.getAllByText('GBPUSD').length).toBeGreaterThan(0);\n\n    // Expand details in compact mode\n    const expandBtns = await screen.findAllByLabelText(/Toggle details for/i);\n    fireEvent.click(expandBtns[0]);\n    const show = await screen.findByRole('button', { name: /show details/i });\n    fireEvent.click(show);\n    const save = await screen.findByRole('button', { name: /save now/i });\n    expect(save).toBeDefined();\n  });\n\n  it('shows validation errors for missing required fields', async () => {\n    render(<TradeJournal repo={new InMemoryTradeRepository()} />);\n    // Direkt Add klicken ohne Felder zu fllen\n    fireEvent.click(screen.getByRole('button', { name: /Add/i }));\n    // Es sollten Fehlermeldungen erscheinen (z.B. fr Symbol, Entry Price, Size, Margin, Leverage, SL)\n    expect((await screen.findAllByText(/symbol/i)).length).toBeGreaterThan(0);\n    expect((await screen.findAllByText(/entry price/i)).length).toBeGreaterThan(0);\n    expect((await screen.findAllByText(/position size/i)).length).toBeGreaterThan(0);\n    expect((await screen.findAllByText(/margin/i)).length).toBeGreaterThan(0);\n    expect((await screen.findAllByText(/leverage/i)).length).toBeGreaterThan(0);\n    expect((await screen.findAllByText(/stop loss/i)).length).toBeGreaterThan(0);\n  });\n\n  it('resets the form when Reset is clicked', async () => {\n    render(<TradeJournal repo={new InMemoryTradeRepository()} />);\n    fireEvent.change(screen.getByLabelText(/Symbol/i), { target: { value: 'TEST' } });\n    fireEvent.click(screen.getByRole('button', { name: /Reset/i }));\n    expect((screen.getByLabelText(/Symbol/i) as HTMLInputElement).value).toBe('');\n  });\n\n  it('shows undo after delete and restores the trade', async () => {\n    const repo = new InMemoryTradeRepository();\n    render(<TradeJournal repo={repo} />);\n    // Add a trade\n    fireEvent.change(screen.getByLabelText(/Symbol/i), { target: { value: 'UNDOUSD' } });\n    fireEvent.change(screen.getByLabelText(/Entry Price/i), { target: { value: '1.000' } });\n    fireEvent.change(screen.getByLabelText(/Position Size/i), { target: { value: '1000' } });\n    fireEvent.change(screen.getByLabelText(/Margin/i), { target: { value: '10' } });\n    fireEvent.change(screen.getByLabelText(/Leverage/i), { target: { value: '1' } });\n    fireEvent.change(screen.getByLabelText(/Stop Loss/i), { target: { value: '0.900' } });\n    fireEvent.click(screen.getByRole('button', { name: /Add/i }));\n    await screen.findByText('UNDOUSD');\n    // Delete: Suche nach Close-Button fr UNDOUSD\n    const closeBtn = screen.getByLabelText('Close UNDOUSD');\n    fireEvent.click(closeBtn);\n    // Undo-Banner sollte erscheinen\n    // Nutze findAllByRole fr Undo-Button und klicke das erste Element (case-insensitive, englisch)\n    const undoBtns = await screen.findAllByRole('button', { name: /undo/i });\n    expect(undoBtns.length).toBeGreaterThan(0);\n    fireEvent.click(undoBtns[0]);\n    // Trade sollte wieder erscheinen\n    expect(await screen.findByText('UNDOUSD')).toBeDefined();\n  });\n\n  it('prefills new trade form from analysis tab', async () => {\n    render(<TradeJournal repo={new InMemoryTradeRepository()} />);\n    // Analyse-Tab ffnen\n    const analyseTab = await screen.findByRole('tab', { name: /Analyse/i });\n    fireEvent.click(analyseTab);\n    // Beispiel-Button suchen und klicken\n    const createBtn = await screen.findByText(/Create example trade from analysis/i);\n    fireEvent.click(createBtn);\n    // Symbol-Feld sollte mit EURUSD befllt sein\n    await waitFor(() => {\n      expect((screen.getByLabelText(/Symbol/i) as HTMLInputElement).value).toMatch(/EURUSD/i);\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeJournal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":58,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":70,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":18},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":143,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":143,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":156,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":163,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":18},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":189,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":189,"endColumn":27,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[7649,7688],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7783,7786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7783,7786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":195,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":195,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7877,7930],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9957,9960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9957,9960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":270,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":270,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10133,10187],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":276,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":276,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[10257,10296],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10378,10381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10378,10381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":287,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":287,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10580,10614],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":315,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":315,"endColumn":17,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[11624,11681],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11819,11822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11819,11822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":340,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12611,12614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12611,12614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":347,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":347,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[12834,12891],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":379,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":379,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[13798,13874],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":384,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":384,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[14068,14147],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":388,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":388,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[14206,14275],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14383,14386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14383,14386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":392,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":392,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[14441,14509],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":400,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":400,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[14862,14940],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":403,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":403,"endColumn":23,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[15049,15189],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":430,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":430,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[15848,15927],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":528,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":528,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19808,19863],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":947,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":947,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36301,36304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36301,36304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":948,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":948,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36369,36372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36369,36372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":954,"column":25,"nodeType":"MemberExpression","messageId":"unexpected","endLine":954,"endColumn":38,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[36632,36673],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":963,"column":27,"nodeType":"MemberExpression","messageId":"unexpected","endLine":963,"endColumn":40,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[37123,37182],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":974,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":974,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37755,37758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37755,37758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useRef, useState } from 'react';\n// Layout is provided by App; do not render Layout again here to avoid duplicate headers\nimport { Card } from '@/presentation/shared/components/Card/Card';\nimport { Button } from '@/presentation/shared/components/Button/Button';\nimport { SideValue } from '@/presentation/shared/components/SideSelect/SideSelect';\nimport { validateNewTrade } from '@/presentation/trade/validation';\nimport styles from './TradeJournal.module.css';\nimport type { TradeRepository } from '@/domain/trade/interfaces/TradeRepository';\nimport { ConfirmDialog } from '@/presentation/shared/components/ConfirmDialog/ConfirmDialog';\nimport { TradeList } from './TradeList/TradeList';\nimport { TradeDetailEditor } from './TradeDetail/TradeDetailEditor';\nimport { Analysis } from '@/presentation/analysis/Analysis';\nimport type { MarketValue } from '@/presentation/shared/components/MarketSelect/MarketSelect';\nimport type { TradeInput } from '@/domain/trade/entities/TradeFactory';\nimport { TradeFactory } from '@/domain/trade/entities/TradeFactory';\nimport { EntryDate } from '@/domain/trade/valueObjects/EntryDate';\nimport { loadSettings } from '@/presentation/settings/settingsStorage';\nimport {\n  COMBINED_MOCK_TRADES,\n  MORE_CRYPTO_MOCK_TRADES,\n  MORE_FOREX_MOCK_TRADES,\n} from '@/infrastructure/trade/repositories/mockData';\nimport type { RepoTrade } from '@/infrastructure/trade/repositories/LocalStorageTradeRepository';\n\n// newly extracted presentational components\nimport { NewTradeForm, type NewTradeFormState } from './components/NewTradeForm/NewTradeForm';\nimport { MarketFilters, StatusFilters } from './components/TradeFilters/TradeFilters';\n\ntype TradeRow = {\n  id: string;\n  market: 'Crypto' | 'Forex' | 'All';\n  symbol: string;\n  entryDate: string;\n  size: number;\n  price: number;\n  side: 'LONG' | 'SHORT';\n  status: 'OPEN' | 'CLOSED' | 'FILLED';\n  pnl: number;\n  notes?: string;\n  entry?: string;\n  sl?: number;\n  tp1?: number;\n  tp2?: number;\n  tp3?: number;\n  tp4?: number;\n  margin?: number;\n  leverage?: number;\n};\n\ntype TradeJournalProps = { repo?: TradeRepository; forceCompact?: boolean };\n\nexport function TradeJournal({ repo, forceCompact }: TradeJournalProps) {\n  // read user setting to decide whether to show Load mock data control\n  const [showLoadMockButton, setShowLoadMockButton] = useState<boolean>(() => {\n    try {\n      const s = loadSettings();\n      return typeof s.showLoadMockButton === 'boolean' ? s.showLoadMockButton : true;\n    } catch (_e) {\n      return true;\n    }\n  });\n  // keep in sync if settings change elsewhere (optional: could add a storage event listener)\n  useEffect(() => {\n    const handler = () => {\n      try {\n        const s = loadSettings();\n        setShowLoadMockButton(\n          typeof s.showLoadMockButton === 'boolean' ? s.showLoadMockButton : true\n        );\n      } catch (_e) {\n        /* ignore */\n      }\n    };\n    window.addEventListener('storage', handler);\n    return () => window.removeEventListener('storage', handler);\n  }, []);\n\n  // modal state for loading mock data\n  const [mockModalOpen, setMockModalOpen] = useState(false);\n  const [mockLoadOption, setMockLoadOption] = useState<'crypto' | 'forex' | 'both'>('both');\n  const [mockLoading, setMockLoading] = useState(false);\n\n  // repository instance must be injected via props (composition root). Do not require() here.\n  const repoRef = useRef<TradeRepository | null>(repo ?? null);\n  // Keep ref in sync if prop changes (composition root may re-create repo)\n  useEffect(() => {\n    repoRef.current = repo ?? null;\n  }, [repo]);\n  if (!repoRef.current) {\n    // Do not auto-create adapters here to keep component testable and avoid require()/dynamic imports.\n    // Only warn once in dev\n    if (typeof process !== 'undefined' && process.env.NODE_ENV === 'development')\n      console.warn(\n        'No TradeRepository provided to TradeJournal; persistence disabled. Provide repo prop from composition root.'\n      );\n  }\n\n  // State fr Positionsdaten (editierbar)\n  const [positions, setPositions] = useState<TradeRow[]>([]);\n  // debug/status for UI (visible) so user sees immediate feedback without console\n  const [lastStatus, setLastStatus] = useState<string | null>(null);\n\n  // market and status filters (missing earlier)  restore here\n  const [marketFilter, setMarketFilter] = useState<'All' | 'Crypto' | 'Forex'>('All');\n  const [tradeStatusFilter, setTradeStatusFilter] = useState<'ALL' | 'OPEN' | 'CLOSED' | 'FILLED'>(\n    'ALL'\n  );\n\n  // selected trade id for left-right layout\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n  // compact editor open state (mobile UX): default closed, open on selection\n  const [compactEditorOpen, setCompactEditorOpen] = useState<boolean>(false);\n\n  // active tab for the Trades card (list | analysis)\n  const [tradesCardTab, setTradesCardTab] = useState<'list' | 'analysis'>('list');\n\n  // track dirty ids (simple set of ids with local unsaved changes)  we only need the setter\n  const [, setDirtyIds] = useState<Set<string>>(new Set());\n\n  // load initial data from repo once on mount\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      if (!repoRef.current) return;\n      const domainTrades = await repoRef.current.getAll();\n      if (!mounted) return;\n      // convert domain Trades to presentation primitives\n      const all = domainTrades.map((dt) => TradeFactory.toDTO(dt));\n      setPositions(all as unknown as TradeRow[]);\n    })();\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  // Mobile modal state for New Trade (used on small screens)\n  const [isMobile, setIsMobile] = useState<boolean>(() => {\n    if (typeof window === 'undefined') return false;\n    // jsdom in test environment may not implement matchMedia; guard it\n    if (typeof window.matchMedia !== 'function') return false;\n    try {\n      return window.matchMedia('(max-width:480px)').matches;\n    } catch (_e) {\n      return false;\n    }\n  });\n  const [newTradeModalOpen, setNewTradeModalOpen] = useState(false);\n\n  // listen for viewport changes to toggle mobile mode\n  useEffect(() => {\n    if (typeof window === 'undefined' || typeof window.matchMedia === 'undefined') return;\n    const mq = window.matchMedia('(max-width:480px)');\n    const handler = (e: MediaQueryListEvent) => setIsMobile(e.matches);\n    try {\n      mq.addEventListener('change', handler);\n    } catch (_e) {\n      mq.addListener(handler);\n    }\n    setIsMobile(mq.matches);\n    return () => {\n      try {\n        mq.removeEventListener('change', handler);\n      } catch (_e) {\n        mq.removeListener(handler);\n      }\n    };\n  }, []);\n\n  // Trades nach Markt filtern (berechnet aus editierbaren Positionen)\n  const trades = (() => {\n    let filtered = positions;\n    if (marketFilter !== 'All') filtered = filtered.filter((t) => t.market === marketFilter);\n    if (tradeStatusFilter === 'OPEN') filtered = filtered.filter((t) => t.status === 'OPEN');\n    if (tradeStatusFilter === 'CLOSED') filtered = filtered.filter((t) => t.status === 'CLOSED');\n    if (tradeStatusFilter === 'FILLED') filtered = filtered.filter((t) => t.status === 'FILLED');\n    return filtered;\n  })();\n\n  // Helper: update trade in state and persist to repo\n  const updateTradeById = async (id: string, patch: Partial<TradeRow>) => {\n    setPositions((prev) => {\n      const next = prev.map((p) => (p.id === id ? { ...p, ...patch } : p));\n      // persist updated trade\n      const updated = next.find((t) => t.id === id);\n      if (updated) {\n        (async () => {\n          try {\n            if (!repoRef.current) {\n              console.warn('Repository unavailable');\n              return;\n            }\n            const domain = TradeFactory.create(updated as any);\n            await repoRef.current.update(domain);\n          } catch (err) {\n            console.error('Failed to persist trade update', err);\n          }\n        })();\n      }\n      return next;\n    });\n  };\n\n  // Called by editor when fields change; mark as dirty and update local positions\n  // Editor works with the presentation DTO shape (id, symbol, entryDate?, size, price, side, notes)\n  type EditorDTO = {\n    id: string;\n    symbol: string;\n    entryDate?: string;\n    size: number;\n    price: number;\n    side: string;\n    notes?: string;\n    status?: 'OPEN' | 'CLOSED' | 'FILLED';\n  };\n\n  const handleEditorChange = useCallback((dto: TradeInput) => {\n    setPositions((prev) =>\n      prev.map((p) =>\n        p.id === dto.id\n          ? {\n              ...p,\n              symbol: dto.symbol,\n              entryDate: dto.entryDate ?? p.entryDate,\n              size: dto.size,\n              price: dto.price,\n              side: dto.side as 'LONG' | 'SHORT',\n              status: dto.status ?? p.status,\n              notes: dto.notes,\n              tp1: dto.tp1 ?? p.tp1,\n              tp2: dto.tp2 ?? p.tp2,\n              tp3: dto.tp3 ?? p.tp3,\n              tp4: dto.tp4 ?? p.tp4,\n              sl: dto.sl ?? p.sl,\n              leverage: dto.leverage ?? p.leverage,\n              market:\n                dto.market === 'Crypto' || dto.market === 'Forex' || dto.market === 'All'\n                  ? dto.market\n                  : p.market,\n            }\n          : p\n      )\n    );\n    setDirtyIds((prev) => {\n      const next = new Set(prev);\n      next.add(dto.id);\n      return next;\n    });\n  }, []);\n\n  // Called by editor to persist change immediately (accepts DTO)\n  const handleEditorSave = useCallback(async (dto: EditorDTO) => {\n    let updatedTrade: TradeRow | null = null;\n    setPositions((prev) => {\n      const existing = prev.find((p) => p.id === dto.id);\n      if (!existing) return prev;\n      updatedTrade = {\n        ...existing,\n        symbol: dto.symbol,\n        entryDate: dto.entryDate ?? existing.entryDate,\n        size: dto.size,\n        price: dto.price,\n        side: dto.side as 'LONG' | 'SHORT',\n        status: (dto as any).status ?? existing.status,\n        notes: dto.notes,\n      };\n      return prev.map((p) => (p.id === dto.id ? updatedTrade! : p));\n    });\n\n    if (!updatedTrade) {\n      console.error('Save failed: trade not found', dto.id);\n      return;\n    }\n\n    try {\n      if (!repoRef.current) {\n        console.warn('Repository unavailable');\n        return;\n      }\n      const domain = TradeFactory.create(updatedTrade as any);\n      await repoRef.current.update(domain);\n      setDirtyIds((prev) => {\n        const next = new Set(prev);\n        next.delete(dto.id);\n        return next;\n      });\n    } catch (err) {\n      console.error('Save failed', err);\n    }\n  }, []);\n\n  // Handler fr das Hinzufgen eines neuen Trades\n  type NewTradeForm = NewTradeFormState;\n\n  const [form, setForm] = useState<NewTradeForm>({\n    symbol: '',\n    entryDate: EntryDate.toInputValue(),\n    size: undefined,\n    price: undefined,\n    side: 'LONG',\n    status: 'OPEN',\n    market: 'Crypto', // default to Crypto to avoid validation blocking when user doesn't explicitly select\n    notes: '',\n  });\n\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\n  // Track which fields the user has interacted with; errors are shown only when touched or after submit\n  const [touched, setTouched] = useState<Record<string, boolean>>({});\n  const [formSubmitted, setFormSubmitted] = useState(false);\n  // key to force remount the New Trade form and its inputs (useful to fully clear internal input state)\n  const [formKey, setFormKey] = useState(0);\n\n  const handleAdd = async (e?: React.FormEvent) => {\n    if (e) e.preventDefault();\n    setFormSubmitted(true);\n    console.info('[TradeJournal] handleAdd start', { form });\n    setLastStatus('handleAdd start');\n\n    // helper: parse form values which may be strings -> numbers\n    const parseNumberField = (v: any): number | undefined => {\n      if (v === undefined || v === null) return undefined;\n      if (typeof v === 'number') return v;\n      const s = String(v).trim();\n      if (s.length === 0) return undefined;\n      const n = Number(s);\n      return Number.isNaN(n) ? undefined : n;\n    };\n\n    // Validate using presentation validation helper (returns array of field errors)\n    const toValidate = {\n      symbol: form.symbol,\n      entryDate: form.entryDate,\n      size: parseNumberField(form.size) ?? undefined,\n      price: parseNumberField(form.price) ?? undefined,\n      side: form.side as string,\n      market: (form.market ?? '') as MarketValue,\n      sl: form.sl,\n      margin: form.margin,\n      leverage: form.leverage,\n    };\n    const validation = validateNewTrade(toValidate as any);\n    const mapped: Record<string, string> = {};\n    validation.forEach((v) => {\n      if (v && v.field) mapped[v.field] = v.message;\n    });\n    if (Object.keys(mapped).length > 0) {\n      setFormErrors(mapped);\n      console.info('[TradeJournal] validation failed', mapped);\n      setLastStatus(`validation failed: ${Object.keys(mapped).join(',')}`);\n      // mark all errored fields as touched so UI shows the messages immediately\n      setTouched((prev) => ({\n        ...prev,\n        ...Object.fromEntries(Object.keys(mapped).map((k) => [k, true])),\n      }));\n      return;\n    }\n\n    const newTrade: TradeRow = {\n      id: crypto.randomUUID(),\n      symbol: form.symbol,\n      entryDate: form.entryDate,\n      size: Number(form.size),\n      price: Number(form.price),\n      side: form.side as 'LONG' | 'SHORT',\n      notes: form.notes || undefined,\n      market: (form.market as Exclude<MarketValue, ''>) || 'Crypto',\n      sl: form.sl,\n      tp1: form.tp1,\n      tp2: form.tp2,\n      tp3: form.tp3,\n      tp4: form.tp4,\n      margin: form.margin,\n      leverage: form.leverage,\n      status: form.status,\n      pnl: 0,\n    };\n\n    try {\n      if (!repoRef.current) {\n        console.warn('[TradeJournal] Repository unavailable; skipping persistence');\n        setLastStatus('repo unavailable; local update');\n        // fallback: update local positions only\n        setPositions((prev) => {\n          const next = [newTrade, ...prev];\n          console.info('[TradeJournal] positions updated (local, no repo)', next.length);\n          return next;\n        });\n      } else {\n        console.info('[TradeJournal] persisting trade to repo', newTrade.id);\n        setLastStatus(`persisting ${newTrade.id}`);\n        const domain = TradeFactory.create(newTrade as any);\n        await repoRef.current.save(domain);\n        console.info('[TradeJournal] persisted trade to repo', newTrade.id);\n        setLastStatus(`persisted ${newTrade.id}`);\n\n        // reload canonical trades from repo to keep UI in sync with storage\n        try {\n          const domainTrades = await repoRef.current.getAll();\n          const dtoTrades = domainTrades.map((dt) => TradeFactory.toDTO(dt) as unknown as TradeRow);\n          setPositions(dtoTrades);\n          console.info('[TradeJournal] reloaded positions from repo', dtoTrades.length);\n          setLastStatus(`reloaded ${dtoTrades.length} trades from repo`);\n        } catch (err) {\n          console.warn(\n            '[TradeJournal] failed to reload from repo after save, falling back to local update',\n            err\n          );\n          setLastStatus('reload failed; fallback to local');\n          setPositions((prev) => [newTrade, ...prev]);\n        }\n      }\n      setLastStatus('Saved');\n      // If we added a trade from the mobile modal, close it and reset form\n      if (newTradeModalOpen) {\n        setNewTradeModalOpen(false);\n      }\n      // reset form\n      setForm({\n        symbol: '',\n        entryDate: EntryDate.toInputValue(),\n        size: undefined,\n        price: undefined,\n        side: 'LONG',\n        status: 'OPEN',\n        market: 'Crypto',\n        notes: '',\n      });\n      setFormSubmitted(false);\n      setFormKey((k) => k + 1);\n    } catch (err) {\n      console.error('[TradeJournal] Failed to persist new trade to repository', err);\n      setLastStatus('persist error');\n      // still update UI so user sees the trade; but surface error in console\n      setPositions((prev) => [newTrade, ...prev]);\n    }\n    setFormErrors({});\n    // clear submission / touched state after successful add\n    setFormSubmitted(false);\n    setTouched({});\n  };\n\n  // responsive fallback: switch to single-column grid when container is too narrow\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [compactGrid, setCompactGrid] = useState(false);\n\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n\n    // If caller forces compact mode (useful for testing or feature flags), respect it and skip ResizeObserver\n    if (typeof forceCompact === 'boolean') {\n      setCompactGrid(forceCompact);\n      return;\n    }\n\n    const tableMin = 900; // same as our table min-width\n    const gap = 18;\n    const extraBuffer = 220; // increase buffer to avoid overlap when window moved/resized\n\n    const compute = () => {\n      const style = getComputedStyle(el);\n      const paddingLeft = parseInt(style.paddingLeft || '0', 10);\n      const paddingRight = parseInt(style.paddingRight || '0', 10);\n      const available = el.clientWidth - paddingLeft - paddingRight;\n\n      // compute left width using the clamp formula: clamp(280px, 22vw, 420px)\n      const vw22 = Math.round((el.clientWidth * 22) / 100);\n      const leftPreferred = Math.min(Math.max(280, vw22), 420);\n\n      const required = leftPreferred + tableMin + gap + extraBuffer;\n      // if available width is less than required, switch to compact\n      setCompactGrid(available < required);\n    };\n\n    const ro = new ResizeObserver(compute);\n    ro.observe(el);\n\n    // initial check\n    compute();\n\n    return () => ro.disconnect();\n  }, [forceCompact]);\n\n  // Confirmation dialog state for SL/close actions\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [confirmTradeId, setConfirmTradeId] = useState<string | null>(null);\n  const [confirmAction, setConfirmAction] = useState<\n    'close' | 'sl-be' | 'sl-hit' | 'toggle-side' | 'delete' | null\n  >(null);\n  // allow undo: store previous trade snapshot and show small undo banner\n  const [undoInfo, setUndoInfo] = useState<{ id: string; prev: TradeRow } | null>(null);\n  const undoTimerRef = useRef<number | null>(null);\n\n  const clearUndo = () => {\n    if (undoTimerRef.current) window.clearTimeout(undoTimerRef.current);\n    undoTimerRef.current = null;\n    setUndoInfo(null);\n  };\n\n  const performAction = (action: NonNullable<typeof confirmAction>, id: string) => {\n    const prev = positions.find((p) => p.id === id);\n    if (!prev) return;\n    const prevCopy = { ...prev };\n\n    if (action === 'toggle-side') {\n      const newSide = prev.side === 'LONG' ? 'SHORT' : 'LONG';\n      updateTradeById(id, { side: newSide });\n    } else if (action === 'sl-be') {\n      // prev.entry may be a string (ISO) or undefined; coerce to number if possible\n      const entryAsNumber = prev.entry ? Number(prev.entry) : undefined;\n      const chosenSl =\n        typeof entryAsNumber === 'number' && !Number.isNaN(entryAsNumber) ? entryAsNumber : prev.sl;\n      updateTradeById(id, { sl: chosenSl, status: 'CLOSED' });\n    } else if (action === 'sl-hit') {\n      updateTradeById(id, { status: 'CLOSED' });\n    } else if (action === 'close') {\n      // user-initiated close -> mark as FILLED (semantic choice)\n      updateTradeById(id, { status: 'FILLED' });\n    } else if (action === 'delete') {\n      // handle delete locally and in repo\n      // set undo info and remove from positions; actual repo deletion will be performed below\n      if (!prev) return;\n      setPositions((prevs) => prevs.filter((p) => p.id !== id));\n      (async () => {\n        try {\n          if (!repoRef.current) return;\n          await repoRef.current.delete(id);\n        } catch (err) {\n          console.error('Failed to delete trade from repo', err);\n        }\n      })();\n      // if the deleted trade was selected in the editor, clear selection\n      if (selectedId === id) setSelectedId(null);\n    }\n\n    // set undo info and auto-clear after 5s\n    setUndoInfo({ id, prev: prevCopy });\n    if (undoTimerRef.current) window.clearTimeout(undoTimerRef.current);\n    undoTimerRef.current = window.setTimeout(() => {\n      setUndoInfo(null);\n      undoTimerRef.current = null;\n    }, 5000);\n  };\n\n  const handleConfirm = () => {\n    if (!confirmAction || !confirmTradeId) return;\n    performAction(confirmAction, confirmTradeId);\n    setConfirmOpen(false);\n    setConfirmAction(null);\n    setConfirmTradeId(null);\n  };\n\n  const handleCancelConfirm = () => {\n    setConfirmOpen(false);\n    setConfirmAction(null);\n    setConfirmTradeId(null);\n  };\n\n  // Request delete flow: open confirm dialog with 'delete' action\n  const requestDeleteTrade = (id: string) => {\n    setConfirmTradeId(id);\n    setConfirmAction('delete');\n    setConfirmOpen(true);\n  };\n\n  const handleUndo = () => {\n    if (!undoInfo) return;\n    updateTradeById(undoInfo.id, undoInfo.prev);\n    clearUndo();\n  };\n\n  // onDelete passed to TradeDetailEditor - shows confirm dialog and then deletes\n  const handleDeleteFromEditor = async (id: string) => {\n    // Use confirm dialog for UX consistency\n    requestDeleteTrade(id);\n  };\n\n  // helper: ISO string -> datetime-local format used by input[type=datetime-local]\n  const toDatetimeLocal = (iso?: string) => {\n    const d = iso ? new Date(iso) : new Date();\n    const pad = (n: number) => String(n).padStart(2, '0');\n    const yyyy = d.getFullYear();\n    const mm = pad(d.getMonth() + 1);\n    const dd = pad(d.getDate());\n    const hh = pad(d.getHours());\n    const min = pad(d.getMinutes());\n    return `${yyyy}-${mm}-${dd}T${hh}:${min}`;\n  };\n\n  // PREFILL the New Trade form from an analysis suggestion (no auto-persist)\n  const handleCreateTradeFromAnalysis = async (\n    s: import('@/presentation/analysis/Analysis').AnalysisSuggestion\n  ) => {\n    const entryDateLocal = toDatetimeLocal(s.entryDate);\n    setForm({\n      symbol: s.symbol,\n      entryDate: entryDateLocal,\n      size: s.size ?? undefined,\n      price: s.price ?? undefined,\n      side: (s.side ?? 'LONG') as SideValue,\n      market: (s.market ?? '') as MarketValue,\n      notes: `Suggested from analysis (${s.market ?? 'unspecified'})`,\n      status: 'OPEN',\n    });\n    // switch to list view so the user can review the New Trade form in the left column\n    setTradesCardTab('list');\n    setMarketFilter(s.market ?? 'All');\n    setSelectedId(null);\n  };\n\n  // helper: reset New Trade form to initial state\n  const resetNewTradeForm = () => {\n    // Use case: allow the user to reset the New Trade form to sensible defaults\n    // (keeps default side: LONG and status: OPEN). This is a true \"reset\" action\n    // distinct from closing/canceling the panel  it clears inputs while keeping\n    // the New Trade UI open so the user can start again.\n    setForm({\n      symbol: '',\n      entryDate: EntryDate.toInputValue(),\n      size: undefined,\n      price: undefined,\n      side: 'LONG',\n      status: 'OPEN',\n      market: 'Crypto',\n      notes: '',\n      sl: undefined,\n      tp1: undefined,\n      tp2: undefined,\n      tp3: undefined,\n      tp4: undefined,\n      leverage: undefined,\n      margin: undefined,\n    });\n    setFormErrors({});\n    // also clear touched and submitted state so no errors are visible after reset\n    setTouched({});\n    setFormSubmitted(false);\n    // force remount of form to clear any input internal state / visual artifacts\n    setFormKey((k) => k + 1);\n  };\n\n  // small visible status panel (debug)  can be removed later\n  const repoEnabled = Boolean(repoRef.current);\n  // read user setting and env default for debug UI\n  const settings = typeof window !== 'undefined' ? loadSettings() : {};\n  const debugUiEnabled =\n    typeof settings.debugUI === 'boolean'\n      ? settings.debugUI\n      : typeof process !== 'undefined' &&\n        (process.env.REACT_APP_DEBUG_UI === 'true' || process.env.NODE_ENV === 'development');\n\n  // compute the selected trade DTO once to avoid inline IIFE in JSX (linting + readability)\n  const selectedPos = positions.find((p) => p.id === selectedId);\n  const selectedTrade = selectedPos\n    ? {\n        id: selectedPos.id,\n        symbol: selectedPos.symbol,\n        entryDate: selectedPos.entryDate,\n        size: selectedPos.size,\n        price: selectedPos.price,\n        side: selectedPos.side,\n        status: selectedPos.status,\n        notes: selectedPos.notes,\n        tp1: selectedPos.tp1,\n        tp2: selectedPos.tp2,\n        tp3: selectedPos.tp3,\n        tp4: selectedPos.tp4,\n        margin: selectedPos.margin,\n        leverage: selectedPos.leverage,\n      }\n    : null;\n\n  return (\n    <>\n      <div className={styles.headerRow}>\n        <h2 className={styles.title}>Trading Journal</h2>\n        <div className={styles.controls}>\n          {showLoadMockButton && (\n            <Button variant=\"secondary\" onClick={() => setMockModalOpen(true)}>\n              Load mock data\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Mobile-only New Trade button: opens modal instead of showing inline form */}\n      <div className={styles.mobileNewTradeBtnWrap}>\n        {isMobile && (\n          <button\n            type=\"button\"\n            className={styles.mobileNewTradeBtn}\n            onClick={() => setNewTradeModalOpen(true)}\n          >\n            New Trade\n          </button>\n        )}\n      </div>\n\n      {/* containerRef wraps the grid so we can detect available width */}\n      <div\n        ref={containerRef}\n        className={\n          compactGrid\n            ? `${styles.grid} ${styles.gridCompact} ${styles.fullScreen}`\n            : `${styles.grid} ${styles.fullScreen}`\n        }\n      >\n        <div className={styles.left}>\n          {/* Desktop & tablet: show inline NewTradeForm; Mobile: hide inline and use modal */}\n          {!isMobile && (\n            <NewTradeForm\n              form={form}\n              formErrors={formErrors}\n              touched={touched}\n              formSubmitted={formSubmitted}\n              formKey={formKey}\n              debugUiEnabled={debugUiEnabled}\n              lastStatus={lastStatus}\n              onChangeForm={(patch) => setForm((prev) => ({ ...prev, ...patch }))}\n              onBlurField={(f) => setTouched((prev) => ({ ...prev, [f]: true }))}\n              onSubmit={(e?: React.FormEvent) => {\n                setFormSubmitted(true);\n                setTouched((prev) => ({ ...prev, price: true }));\n                handleAdd(e);\n              }}\n              onReset={resetNewTradeForm}\n              setMarketFilter={(m) =>\n                setMarketFilter(m === '' ? 'All' : (m as 'All' | 'Crypto' | 'Forex'))\n              }\n            />\n          )}\n        </div>\n\n        <div className={styles.right}>\n          <Card\n            tabs={[\n              {\n                key: 'list',\n                title: 'List',\n                render: () => (\n                  <>\n                    <div className={styles.tradesHeader}>\n                      <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n                        <div className={styles.tradesTitle}>Trades</div>\n                        <div className={styles.tradesStatusRow}>\n                          <StatusFilters\n                            tradeStatusFilter={tradeStatusFilter}\n                            setTradeStatusFilter={(s) => setTradeStatusFilter(s)}\n                          />\n                        </div>\n                      </div>\n                      <div className={styles.tradesControls}>\n                        <MarketFilters\n                          marketFilter={marketFilter}\n                          setMarketFilter={(m) => setMarketFilter(m)}\n                          tradesCount={trades.length}\n                        />\n                      </div>\n                    </div>\n\n                    <div className={styles.listAndDetailWrap}>\n                      {/* Correct conditional rendering: when compactGrid is true stack list and editor in leftPane; otherwise keep leftPane + rightPane */}\n                      {compactGrid ? (\n                        <div className={styles.leftPane}>\n                          <TradeList\n                            trades={trades.map((t) => ({\n                              id: t.id,\n                              symbol: t.symbol,\n                              entryDate: t.entryDate,\n                              size: t.size,\n                              price: t.price,\n                              side: t.side,\n                              status: t.status,\n                              notes: t.notes,\n                            }))}\n                            selectedId={selectedId}\n                            onSelect={(id) => setSelectedId(id)}\n                            compactView={compactGrid}\n                          />\n                          <div style={{ height: 12 }} />\n                          {selectedTrade ? (\n                            compactEditorOpen ? (\n                              <div>\n                                <div className={styles.compactControls}>\n                                  <Button\n                                    variant=\"ghost\"\n                                    onClick={() => setCompactEditorOpen(false)}\n                                  >\n                                    Hide details\n                                  </Button>\n                                </div>\n                                <TradeDetailEditor\n                                  trade={selectedTrade}\n                                  onChange={handleEditorChange}\n                                  onSave={handleEditorSave}\n                                  onDelete={(id) => handleDeleteFromEditor(id)}\n                                  compactView={compactGrid}\n                                />\n                              </div>\n                            ) : (\n                              <div\n                                className={styles.compactSummary}\n                                role=\"region\"\n                                aria-live=\"polite\"\n                              >\n                                <div\n                                  style={{\n                                    display: 'flex',\n                                    justifyContent: 'space-between',\n                                    alignItems: 'center',\n                                  }}\n                                >\n                                  <div>\n                                    <div style={{ fontWeight: 700 }}>{selectedTrade.symbol}</div>\n                                    <div style={{ color: 'var(--muted)', fontSize: 13 }}>\n                                      {new Date(selectedTrade.entryDate).toLocaleString()}\n                                    </div>\n                                  </div>\n                                  <div>\n                                    <Button\n                                      variant=\"primary\"\n                                      onClick={() => setCompactEditorOpen(true)}\n                                    >\n                                      Show details\n                                    </Button>\n                                  </div>\n                                </div>\n                              </div>\n                            )\n                          ) : (\n                            <div\n                              className={styles.compactPlaceholder}\n                              role=\"region\"\n                              aria-live=\"polite\"\n                            >\n                              <div style={{ fontWeight: 700, marginBottom: 6 }}>Keine Auswahl</div>\n                              <div style={{ color: 'var(--muted)' }}>\n                                Whle einen Trade in der Liste, um die Details zu bearbeiten.\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      ) : (\n                        <>\n                          <div className={styles.leftPane}>\n                            <TradeList\n                              trades={trades.map((t) => ({\n                                id: t.id,\n                                symbol: t.symbol,\n                                entryDate: t.entryDate,\n                                size: t.size,\n                                price: t.price,\n                                side: t.side,\n                                status: t.status,\n                                notes: t.notes,\n                              }))}\n                              selectedId={selectedId}\n                              onSelect={(id) => setSelectedId(id)}\n                              compactView={compactGrid}\n                            />\n                          </div>\n\n                          <div className={styles.rightPane}>\n                            <TradeDetailEditor\n                              trade={selectedTrade}\n                              onChange={handleEditorChange}\n                              onSave={handleEditorSave}\n                              onDelete={(id) => handleDeleteFromEditor(id)}\n                            />\n                          </div>\n                        </>\n                      )}\n                    </div>\n                  </>\n                ),\n              },\n              {\n                key: 'analysis',\n                title: 'Analyse',\n                render: () => <Analysis onCreateTradeSuggestion={handleCreateTradeFromAnalysis} />,\n              },\n            ]}\n            activeTabKey={tradesCardTab}\n            onTabChange={(k) => setTradesCardTab(k as 'list' | 'analysis')}\n          />\n        </div>\n      </div>\n\n      <ConfirmDialog\n        open={confirmOpen}\n        onConfirm={handleConfirm}\n        onCancel={handleCancelConfirm}\n        title=\"Besttigung erforderlich\"\n        message={`Sind Sie sicher, dass Sie diese Aktion durchfhren mchten?`}\n        confirmLabel=\"Ja\"\n        cancelLabel=\"Abbrechen\"\n        confirmVariant={confirmAction === 'delete' ? 'danger' : 'primary'}\n      />\n\n      {/* Mock data loader modal */}\n      {mockModalOpen && (\n        <div className={styles.backdrop} role=\"dialog\" aria-modal=\"true\">\n          <div className={styles.mockDialog}>\n            <h3>Lade Mock-Daten</h3>\n            <p>\n              Whle welches Set an Testdaten du laden mchtest. Bereits vorhandene Daten bleiben\n              erhalten.\n            </p>\n            <div style={{ display: 'flex', gap: 8, marginTop: 12, marginBottom: 12 }}>\n              <Button\n                variant={mockLoadOption === 'crypto' ? 'primary' : 'ghost'}\n                onClick={() => setMockLoadOption('crypto')}\n              >\n                Crypto\n              </Button>\n              <Button\n                variant={mockLoadOption === 'forex' ? 'primary' : 'ghost'}\n                onClick={() => setMockLoadOption('forex')}\n              >\n                Forex\n              </Button>\n              <Button\n                variant={mockLoadOption === 'both' ? 'primary' : 'ghost'}\n                onClick={() => setMockLoadOption('both')}\n              >\n                Both\n              </Button>\n            </div>\n            <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\n              <Button variant=\"ghost\" onClick={() => setMockModalOpen(false)}>\n                Cancel\n              </Button>\n              <Button\n                variant=\"primary\"\n                onClick={async () => {\n                  setMockLoading(true);\n                  try {\n                    const seedSet =\n                      mockLoadOption === 'crypto'\n                        ? MORE_CRYPTO_MOCK_TRADES\n                        : mockLoadOption === 'forex'\n                        ? MORE_FOREX_MOCK_TRADES\n                        : COMBINED_MOCK_TRADES;\n\n                    // prefer calling a seed method if repo supports it\n                    const repoAny = repoRef.current as unknown as {\n                      seed?: (trades: RepoTrade[]) => void;\n                      save?: (t: any) => Promise<void>;\n                      getAll?: () => Promise<any[]>;\n                    } | null;\n                    if (repoAny && typeof repoAny.seed === 'function') {\n                      try {\n                        repoAny.seed(seedSet as RepoTrade[]);\n                      } catch (err) {\n                        console.error('seed() call failed', err);\n                      }\n                    } else if (repoAny && typeof repoAny.save === 'function') {\n                      // save each trade sequentially\n                      for (const rt of seedSet) {\n                        try {\n                          const domain = TradeFactory.create(rt as unknown as TradeInput);\n                          await repoAny.save(domain);\n                        } catch (err) {\n                          console.error('Failed to save mock trade via save()', err);\n                        }\n                      }\n                    } else {\n                      // no repo available - update UI only\n                      // Normalize status to avoid UNKNOWN values in the list when mock items lack a status\n                      setPositions((prev) => {\n                        const combined = seedSet.map((t) => ({ ...t }));\n                        const dto = combined.map((c) => ({\n                          ...c,\n                          entryDate: EntryDate.toInputValue(c.entryDate),\n                          status: (c as any).status ?? 'OPEN',\n                        })) as unknown as TradeRow[];\n                        return [...dto, ...prev];\n                      });\n                    }\n\n                    // reload canonical trades from repo\n                    if (repoRef.current && typeof repoRef.current.getAll === 'function') {\n                      const domainTrades = await repoRef.current.getAll();\n                      const dtoTrades = domainTrades.map(\n                        (dt) => TradeFactory.toDTO(dt) as unknown as TradeRow\n                      );\n                      setPositions(dtoTrades);\n                    }\n                  } finally {\n                    setMockLoading(false);\n                    setMockModalOpen(false);\n                  }\n                }}\n              >\n                {mockLoading ? 'Loading' : 'Load'}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {undoInfo && (\n        <div className={styles.undoBanner}>\n          <div className={styles.undoContent}>\n            <div>Aktion durchgefhrt  Rckgngig mglich</div>\n            <Button variant=\"ghost\" onClick={handleUndo}>\n              Undo\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Debug/status banner (dev-only) */}\n      {repoEnabled && debugUiEnabled && (\n        <div className={styles.statusBanner}>\n          <div>{positions.length} trades loaded</div>\n          {lastStatus && <div className={styles.statusMessage}>{lastStatus}</div>}\n        </div>\n      )}\n      {/* Mobile modal for New Trade */}\n      {isMobile && newTradeModalOpen && (\n        <div\n          className={styles.mobileModalBackdrop}\n          role=\"dialog\"\n          aria-modal=\"true\"\n          tabIndex={-1}\n          onClick={() => setNewTradeModalOpen(false)}\n        >\n          <div\n            className={styles.mobileModalContent}\n            onClick={(e) => e.stopPropagation()}\n            tabIndex={0}\n          >\n            <button\n              type=\"button\"\n              aria-label=\"Close\"\n              onClick={() => setNewTradeModalOpen(false)}\n              style={{\n                position: 'absolute',\n                top: 8,\n                right: 8,\n                background: 'none',\n                border: 'none',\n                fontSize: 22,\n                cursor: 'pointer',\n              }}\n            >\n              \n            </button>\n            <div style={{ marginBottom: 12, fontWeight: 700, fontSize: 18 }}>New Trade</div>\n            <NewTradeForm\n              form={form}\n              formErrors={formErrors}\n              touched={touched}\n              formSubmitted={formSubmitted}\n              formKey={formKey}\n              debugUiEnabled={debugUiEnabled}\n              lastStatus={lastStatus}\n              onChangeForm={(patch) => setForm((prev) => ({ ...prev, ...patch }))}\n              onBlurField={(f) => setTouched((prev) => ({ ...prev, [f]: true }))}\n              onSubmit={(e?: React.FormEvent) => {\n                setFormSubmitted(true);\n                setTouched((prev) => ({ ...prev, price: true }));\n                handleAdd(e);\n              }}\n              onReset={resetNewTradeForm}\n              setMarketFilter={(m) =>\n                setMarketFilter(m === '' ? 'All' : (m as 'All' | 'Crypto' | 'Forex'))\n              }\n            />\n            {/* Mobile sticky footer: always visible in the sheet so Add/Close are accessible */}\n            <div className={styles.mobileModalFooter}>\n              <Button variant=\"ghost\" onClick={() => setNewTradeModalOpen(false)}>\n                Close\n              </Button>\n              <Button\n                variant=\"primary\"\n                onClick={async () => {\n                  // ensure validation messages appear\n                  setFormSubmitted(true);\n                  setTouched((prev) => ({ ...prev, price: true }));\n                  await handleAdd();\n                }}\n              >\n                Add\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeList/TradeList.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/TradeList/TradeList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/NewTradeForm/NewTradeForm.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[486,489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[486,489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10164,10167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10164,10167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10196,10199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10196,10199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":343,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10655,10658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10655,10658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":343,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10688,10691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10688,10691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10963,10966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10963,10966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10996,10999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10996,10999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":355,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11253,11256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11253,11256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":355,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11286,11289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11286,11289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from '@testing-library/react';\nimport { describe, it, vi, expect } from 'vitest';\nimport { NewTradeForm } from './NewTradeForm';\n\nconst baseForm = {\n  symbol: '',\n  entryDate: '2025-12-28T12:00',\n  size: undefined,\n  price: undefined,\n  side: 'LONG' as const,\n  status: 'OPEN' as const,\n  notes: '',\n  sl: undefined,\n  tp1: undefined,\n  tp2: undefined,\n  tp3: undefined,\n  tp4: undefined,\n  leverage: undefined,\n  margin: undefined,\n  market: '' as any,\n};\n\ndescribe('NewTradeForm', () => {\n  it('calls onChangeForm when inputs change and onSubmit when submitted', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn((e) => e && e.preventDefault());\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={1}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    // symbol input\n    const symbol = screen.getByLabelText('Symbol') as HTMLInputElement;\n    fireEvent.change(symbol, { target: { value: 'BTC' } });\n    expect(onChangeForm).toHaveBeenCalled();\n\n    // price input\n    const price = screen.getByLabelText('Entry Price *') as HTMLInputElement;\n    fireEvent.change(price, { target: { value: '123.45' } });\n    expect(onChangeForm).toHaveBeenCalled();\n\n    // submit by clicking Add\n    fireEvent.click(screen.getByText('Add'));\n    expect(onSubmit).toHaveBeenCalled();\n  });\n\n  it('displays errors when provided and setMarketFilter is called when market changes', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn((e) => e && e.preventDefault());\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={{ ...baseForm, market: '' }}\n        formErrors={{ symbol: 'Required', market: 'Market required' }}\n        touched={{ symbol: true, market: true }}\n        formSubmitted={true}\n        formKey={2}\n        debugUiEnabled={true}\n        lastStatus={'ERR'}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    // debug section should contain status and errors text\n    expect(screen.getByText(/Status:/)).toBeDefined();\n    expect(screen.getByText(/Form errors:/)).toBeDefined();\n\n    // click an available market button (MarketSelect renders 'Forex' and 'Crypto' in this compact view)\n    const marketBtn = screen.getByText('Forex');\n    fireEvent.click(marketBtn);\n    expect(setMarketFilter).toHaveBeenCalled();\n  });\n\n  // New tests covering more branches\n  it('calls onBlurField for symbol and price on blur', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={3}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    const symbol = screen.getByLabelText('Symbol') as HTMLInputElement;\n    fireEvent.blur(symbol);\n    expect(onBlurField).toHaveBeenCalled();\n\n    const price = screen.getByLabelText('Entry Price *') as HTMLInputElement;\n    fireEvent.blur(price);\n    expect(onBlurField).toHaveBeenCalled();\n  });\n\n  it('Reset button calls onReset', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={4}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    fireEvent.click(screen.getByLabelText('Reset new trade form'));\n    expect(onReset).toHaveBeenCalled();\n  });\n\n  it('side select change triggers onChangeForm', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={5}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    const sideSelect = screen.getByLabelText('New trade side') as HTMLSelectElement;\n    fireEvent.change(sideSelect, { target: { value: 'SHORT' } });\n    expect(onChangeForm).toHaveBeenCalled();\n  });\n\n  it('shows field-specific errors when touched but not submitted', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{ symbol: 'Required', price: 'Price required' }}\n        touched={{ symbol: true, price: true }}\n        formSubmitted={false}\n        formKey={6}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    expect(screen.getByText('Required')).toBeDefined();\n    expect(screen.getByText('Price required')).toBeDefined();\n  });\n\n  it('shows all field errors and sets aria-describedby when formSubmitted=true', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    const errors = {\n      market: 'mErr',\n      symbol: 'sErr',\n      price: 'pErr',\n      margin: 'm2',\n      leverage: 'levErr',\n      size: 'sizeErr',\n      side: 'sideErr',\n      sl: 'slErr',\n      tp1: 'tp1Err',\n      tp2: 'tp2Err',\n      tp3: 'tp3Err',\n      tp4: 'tp4Err',\n      status: 'statusErr',\n    };\n\n    const { container } = render(\n      <NewTradeForm\n        form={{ ...baseForm, market: '' }}\n        formErrors={errors}\n        touched={{}}\n        formSubmitted={true}\n        formKey={7}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    // check presence of error nodes by id\n    expect(container.querySelector('#market-error')).toBeTruthy();\n    expect(container.querySelector('#symbol-error')).toBeTruthy();\n    expect(container.querySelector('#price-error')).toBeTruthy();\n    expect(container.querySelector('#margin-error')).toBeTruthy();\n    expect(container.querySelector('#leverage-error')).toBeTruthy();\n    expect(container.querySelector('#size-error')).toBeTruthy();\n    expect(container.querySelector('#side-error')).toBeTruthy();\n    expect(container.querySelector('#sl-error')).toBeTruthy();\n    expect(container.querySelector('#tp1-error')).toBeTruthy();\n    expect(container.querySelector('#tp2-error')).toBeTruthy();\n    expect(container.querySelector('#tp3-error')).toBeTruthy();\n    expect(container.querySelector('#tp4-error')).toBeTruthy();\n    expect(container.querySelector('#status-error')).toBeTruthy();\n\n    // check that inputs reference the error ids via aria-describedby where applicable\n    const symbolInput = screen.getByLabelText('Symbol');\n    expect(symbolInput.getAttribute('aria-describedby')).toBe('symbol-error');\n\n    const priceInput = screen.getByLabelText('Entry Price *');\n    expect(priceInput.getAttribute('aria-describedby')).toBe('price-error');\n  });\n\n  it('StatusSelect onChange triggers onChangeForm and onBlurField', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={8}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    // find the select by its label 'Status'\n    const statusSelect = screen.getByLabelText('Status') as HTMLSelectElement;\n    // change value\n    fireEvent.change(statusSelect, { target: { value: 'CLOSED' } });\n    // onChangeForm should have been called\n    expect(onChangeForm).toHaveBeenCalled();\n    // onBlurField is called in the onChange handler as well\n    expect(onBlurField).toHaveBeenCalled();\n  });\n\n  it('numeric inputs convert to numbers and empty to undefined', () => {\n    const onChangeForm = vi.fn();\n    const onBlurField = vi.fn();\n    const onSubmit = vi.fn();\n    const onReset = vi.fn();\n    const setMarketFilter = vi.fn();\n\n    render(\n      <NewTradeForm\n        form={baseForm}\n        formErrors={{}}\n        touched={{}}\n        formSubmitted={false}\n        formKey={9}\n        debugUiEnabled={false}\n        onChangeForm={onChangeForm}\n        onBlurField={onBlurField}\n        onSubmit={onSubmit}\n        onReset={onReset}\n        setMarketFilter={setMarketFilter}\n      />\n    );\n\n    // price -> number\n    const price = screen.getByLabelText('Entry Price *') as HTMLInputElement;\n    fireEvent.change(price, { target: { value: '123.45' } });\n    const priceCalled = (onChangeForm as any).mock.calls.some(\n      (c: any) => c[0] && c[0].price === 123.45\n    );\n    expect(priceCalled).toBeTruthy();\n\n    // NOTE: Clearing controlled inputs in this test harness may not reliably fire an onChange with undefined\n    // so we avoid asserting on the empty->undefined behavior here.\n\n    // margin -> number\n    const margin = screen.getByLabelText('Margin *') as HTMLInputElement;\n    fireEvent.change(margin, { target: { value: '10' } });\n    const lastCall2 = (onChangeForm as any).mock.calls[(onChangeForm as any).mock.calls.length - 1];\n    expect(lastCall2[0].margin).toBe(10);\n\n    // leverage -> number\n    const leverage = screen.getByLabelText('Leverage *') as HTMLInputElement;\n    fireEvent.change(leverage, { target: { value: '5' } });\n    const lastCall3 = (onChangeForm as any).mock.calls[(onChangeForm as any).mock.calls.length - 1];\n    expect(lastCall3[0].leverage).toBe(5);\n\n    // tp1 -> number\n    const tp1 = screen.getByLabelText('TP1') as HTMLInputElement;\n    fireEvent.change(tp1, { target: { value: '1.11' } });\n    const lastCall4 = (onChangeForm as any).mock.calls[(onChangeForm as any).mock.calls.length - 1];\n    expect(lastCall4[0].tp1).toBe(1.11);\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/NewTradeForm/NewTradeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/PositionCard/PositionCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/PositionCard/PositionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/TradeFilters/TradeFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/components/TradeFilters/TradeFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/errorMapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[352,355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[352,355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[538,541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[538,541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { mapTradeError } from './errorMapper';\n\ndescribe('mapTradeError', () => {\n  it('maps field error objects', () => {\n    const err = { field: 'market', message: 'Bitte Markt auswhlen' };\n    const mapped = mapTradeError(err);\n    expect((mapped as any).field).toBe('market');\n    expect((mapped as any).message).toBe('Bitte Markt auswhlen');\n  });\n\n  it('returns default message for unknown errors', () => {\n    const mapped = mapTradeError(new Error('boom'));\n    expect((mapped as any).message).toBe('Unbekannter Fehler beim Erstellen des Trades');\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/errorMapper.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[128,141],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[170,173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[170,173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[199,202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[199,202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function mapTradeError(err: unknown) {\n  if (err && typeof err === 'object' && 'field' in err && 'message' in err) {\n    // @ts-ignore\n    return { field: (err as any).field, message: (err as any).message };\n  }\n  return { message: 'Unbekannter Fehler beim Erstellen des Trades' };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/validation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[452,455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[452,455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[760,763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[760,763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1123,1126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1123,1126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1554,1557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1554,1557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { validateNewTrade } from './validation';\n\ndescribe('validateNewTrade', () => {\n  it('returns no errors for a valid input', () => {\n    const input = {\n      symbol: 'AAPL',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 100,\n      side: 'LONG',\n      market: 'Crypto',\n      sl: 10,\n      margin: 100,\n      leverage: 2,\n    };\n    const errors = validateNewTrade(input as any);\n    expect(errors).toEqual([]);\n  });\n\n  it('returns market error when market empty', () => {\n    const input = {\n      symbol: 'AAPL',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 100,\n      side: 'LONG',\n      market: '',\n    };\n    const errors = validateNewTrade(input as any);\n    expect(errors.some((e) => e && e.field === 'market')).toBeTruthy();\n  });\n\n  it('returns size and price errors for invalid numbers', () => {\n    const input = {\n      symbol: 'AAPL',\n      entryDate: new Date().toISOString(),\n      size: 0,\n      price: -1,\n      side: 'LONG',\n      market: 'Forex',\n    };\n    const errors = validateNewTrade(input as any);\n    expect(errors.some((e) => e && e.field === 'size')).toBeTruthy();\n    expect(errors.some((e) => e && e.field === 'price')).toBeTruthy();\n  });\n\n  it('returns errors when sl/margin/leverage missing', () => {\n    const input = {\n      symbol: 'AAPL',\n      entryDate: new Date().toISOString(),\n      size: 1,\n      price: 100,\n      side: 'LONG',\n      market: 'Crypto',\n    };\n    const errors = validateNewTrade(input as any);\n    expect(errors.some((e) => e && e.field === 'sl')).toBeTruthy();\n    expect(errors.some((e) => e && e.field === 'margin')).toBeTruthy();\n    expect(errors.some((e) => e && e.field === 'leverage')).toBeTruthy();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/morpheus/git/github/monkey-trader/traders-mirror/src/presentation/trade/validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
